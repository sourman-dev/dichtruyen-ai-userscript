// ==UserScript==
// @name         dichtruyen.ai.vn
// @namespace    https://github.com/sourman-dev/dichtruyen-ai-userscript
// @version      0.0.4
// @author       suppaman101@gmail.com
// @description  Userscript hỗ trợ đọc dịch online các loại truyện convert, truyện tiếng nước ngoài bằng AI
// @license      MIT
// @icon         https://vitejs.dev/logo.svg
// @supportURL   https://github.com/sourman-dev/dichtruyen-ai-userscript/issues
// @downloadURL  https://raw.githubusercontent.com/sourman-dev/dichtruyen-ai-userscript/main/dist/dichtruyen.ai.vn.user.js
// @updateURL    https://raw.githubusercontent.com/sourman-dev/dichtruyen-ai-userscript/main/dist/dichtruyen.ai.vn.user.js
// @match        *://*/*
// @grant        GM.getValue
// @grant        GM.setValue
// @inject-into  content
// ==/UserScript==

(async function () {
	'use strict';

	let t,n,a,o,r,s,i=Object.getPrototypeOf,l={isConnected:1},u={},c=i(l),h=i(i),addAndScheduleOnFirst=(t,n,a,o)=>(t??(setTimeout(a,o),new Set)).add(n),runAndCaptureDeps=(t,n,o)=>{let r=a;a=n;try{return t(o)}catch(e){return console.error(e),o}finally{a=r;}},keepConnected=t=>t.filter((t=>t._dom?.isConnected)),addStatesToGc=t=>r=addAndScheduleOnFirst(r,t,(()=>{for(let t of r)t._bindings=keepConnected(t._bindings),t._listeners=keepConnected(t._listeners);r=s;}),1e3),d={get val(){return a?._getters?.add(this),this.rawVal},get oldVal(){return a?._getters?.add(this),this._oldVal},set val(o){a?._setters?.add(this),o!==this.rawVal&&(this.rawVal=o,this._bindings.length+this._listeners.length?(n?.add(this),t=addAndScheduleOnFirst(t,this,updateDoms)):this._oldVal=o);}},state$1=t=>({__proto__:d,rawVal:t,_oldVal:t,_bindings:[],_listeners:[]}),bind=(t,n)=>{let a={_getters:new Set,_setters:new Set},r={f:t},s=o;o=[];let i=runAndCaptureDeps(t,a,n);i=(i??document).nodeType?i:new Text(i);for(let o of a._getters)a._setters.has(o)||(addStatesToGc(o),o._bindings.push(r));for(let l of o)l._dom=i;return o=s,r._dom=i},derive$1=(t,n=state$1(),a)=>{let r={_getters:new Set,_setters:new Set},s={f:t,s:n};s._dom=a??o?.push(s)??l,n.val=runAndCaptureDeps(t,r,n.rawVal);for(let o of r._getters)r._setters.has(o)||(addStatesToGc(o),o._listeners.push(s));return n},add$1=(t,...n)=>{for(let a of n.flat(1/0)){let n=i(a??0),o=n===d?bind((()=>a.val)):n===h?bind(a):a;o!=s&&t.append(o);}return t},tag=(t,n,...a)=>{let[{is:o,...r},...l]=i(a[0]??0)===c?a:[{},...a],p=t?document.createElementNS(t,n,{is:o}):document.createElement(n,{is:o});for(let[c,g]of Object.entries(r)){let getPropDescriptor=t=>t?Object.getOwnPropertyDescriptor(t,c)??getPropDescriptor(i(t)):s,t=n+","+c,a=u[t]??=getPropDescriptor(i(p))?.set??0,o=c.startsWith("on")?(t,n)=>{let a=c.slice(2);p.removeEventListener(a,n),p.addEventListener(a,t);}:a?a.bind(p):p.setAttribute.bind(p,c),r=i(g??0);c.startsWith("on")||r===h&&(g=derive$1(g),r=d),r===d?bind((()=>(o(g.val,g._oldVal),p))):o(g);}return add$1(p,l)},handler=t=>({get:(n,a)=>tag.bind(s,t,a)}),update=(t,n)=>n?n!==t&&t.replaceWith(n):t.remove(),updateDoms=()=>{let a=0,o=[...t].filter((t=>t.rawVal!==t._oldVal));do{n=new Set;for(let t of new Set(o.flatMap((t=>t._listeners=keepConnected(t._listeners)))))derive$1(t.f,t.s,t._dom),t._dom=s;}while(++a<100&&(o=[...n]).length);let r=[...t].filter((t=>t.rawVal!==t._oldVal));t=s;for(let t of new Set(r.flatMap((t=>t._bindings=keepConnected(t._bindings)))))update(t._dom,bind(t.f,t._dom)),t._dom=s;for(let t of r)t._oldVal=t.rawVal;};const p={tags:new Proxy((t=>new Proxy(tag,handler(t))),handler()),hydrate:(t,n)=>update(t,bind(n,t)),add:add$1,state:state$1,derive:derive$1};function e(t,n,a={mode:"open"}){window.customElements.define(t,class extends HTMLElement{constructor(){super(),this.a=[];}setAttribute(t,n){super.setAttribute(t,n),this.a[t]&&(this.a[t].val=n);}connectedCallback(){let t;p.add(a?this.attachShadow(a):this,n({attr:(t,n)=>this.a[t]??=p.state(this.getAttribute(t)??n),mount:n=>{let a=t;t=()=>{let t=a?.(),o=n();return ()=>{t?.(),o?.();}};},$this:this})),this.d=t?.();}disconnectedCallback(){this.d?.();}});}const{button:g,div:P,header:V,input:B,label:v,span:C,style:b}=p.tags,toStyleStr=t=>Object.entries(t).map((([t,n])=>`${t}: ${n};`)).join(""),Await=({value:t,container:n=P,Loading:a,Error:o},r)=>{const s=p.state({status:"pending"});return t.then((t=>s.val={status:"fulfilled",value:t})).catch((t=>s.val={status:"rejected",value:t})),n((()=>"pending"===s.val.status?a?.()??"":"rejected"===s.val.status?o?.(s.val.value):r(s.val.value)))};let E=0;const Tabs=({activeTab:t,resultClass:n="",style:a="",tabButtonRowColor:o="#f1f1f1",tabButtonBorderStyle:r="1px solid #000",tabButtonHoverColor:s="#ddd",tabButtonActiveColor:i="#ccc",transitionSec:l=.3,tabButtonRowClass:u="",tabButtonRowStyleOverrides:c={},tabButtonClass:h="",tabButtonStyleOverrides:d={},tabContentClass:V="",tabContentStyleOverrides:B={}},v)=>{const C=t??p.state(Object.keys(v)[0]),b=toStyleStr({overflow:"hidden","background-color":o,...c}),T=toStyleStr({float:"left",border:"none","border-right":r,outline:"none",cursor:"pointer",padding:"8px 16px",transition:`background-color ${l}s`,...d}),A=toStyleStr({padding:"6px 12px","border-top":"none",...B}),w="vanui-tabs-"+ ++E;return document.head.appendChild(p.tags.style(`#${w} .vanui-tab-button { background-color: inherit }\n#${w} .vanui-tab-button:hover { background-color: ${s} }\n#${w} .vanui-tab-button.active { background-color: ${i} }`)),P({id:w,class:n,style:a},P({class:u,style:b},Object.keys(v).map((t=>g({class:()=>["vanui-tab-button"].concat(h||[],t===C.val?"active":[]).join(" "),style:T,onclick:()=>C.val=t},t)))),Object.entries(v).map((([t,n])=>P({class:V,style:()=>`display: ${t===C.val?"block":"none"}; ${A}`},n))))};let T,A,{fromEntries:w,entries:S,keys:O,hasOwn:x,getPrototypeOf:I}=Object,{get:R,set:M,deleteProperty:L,ownKeys:D}=Reflect,{state:k,derive:F,add:G}=p,j=Symbol(),q=Symbol(),$=Symbol(),W=Symbol(),K=Symbol(),Y=Symbol(),isObject=t=>t instanceof Object&&!(t instanceof Function)&&!t[Y],toState=t=>{if(t?.[q]){let n=k();return F((()=>{let a=t();isObject(n.rawVal)&&isObject(a)?replace(n.rawVal,a):n.val=reactive(a);})),n}return k(reactive(t))},J={get:(t,n,a)=>n===j?t:x(t,n)?Array.isArray(t)&&"length"===n?(t[W].val,t.length):t[n].val:R(t,n,a),set:(t,n,a,o)=>x(t,n)?Array.isArray(t)&&"length"===n?(a!==t.length&&++t[W].val,t.length=a,1):(t[n].val=reactive(a),1):n in t?M(t,n,a,o):M(t,n,toState(a))&&(++t[W].val,filterBindings(t).forEach(addToContainer.bind(T,o,n,t[n],A)),1),deleteProperty:(t,n)=>(L(t,n)&&onDelete(t,n),++t[W].val),ownKeys:t=>(t[W].val,D(t))},reactive=t=>!isObject(t)||t[j]?t:new Proxy((t=>{let n=Array.isArray(t)?[]:{__proto__:I(t)};for(let[a,o]of S(t))n[a]=toState(o);return n[$]=[],n[W]=k(1),n})(t),J),filterBindings=t=>t[$]=t[$].filter((t=>t._containerDom.isConnected)),addToContainer=(t,n,a,o,{_containerDom:r,f:s})=>{let i=Array.isArray(t),l=i?Number(n):n;G(r,(()=>r[K][n]=s(a,(()=>delete t[n]),l))),i&&!o&&l!==t.length-1&&r.insertBefore(r.lastChild,r[K][O(t).find((t=>Number(t)>l))]);},onDelete=(t,n)=>{for(let a of filterBindings(t)){let t=a._containerDom[K];t[n]?.remove(),delete t[n];}},replaceInternal=(t,n)=>{for(let[r,s]of S(n)){let n=t[r];isObject(n)&&isObject(s)?replaceInternal(n,s):t[r]=s;}for(let r in t)x(n,r)||delete t[r];let a=O(n),o=Array.isArray(t);if(o||O(t).some(((t,n)=>t!==a[n]))){let r=t[j];if(o)t.length=n.length;else {++r[W].val;let t={...r};for(let n of a)delete r[n];for(let n of a)r[n]=t[n];}for(let{_containerDom:t}of filterBindings(r)){let{firstChild:n,[K]:o}=t;for(let r of a)n===o[r]?n=n.nextSibling:t.insertBefore(o[r],n);}}return t},replace=(t,n)=>{A=1;try{return replaceInternal(t,n instanceof Function?Array.isArray(t)?n(t.filter((t=>1))):w(n(S(t))):n)}finally{A=T;}},compact=t=>Array.isArray(t)?t.filter((t=>1)).map(compact):isObject(t)?w(S(t).map((([t,n])=>[t,compact(n)]))):t;var z=function(){function defineProperties(t,n){for(var a=0;a<n.length;a++){var o=n[a];o.enumerable=o.enumerable||false,o.configurable=true,"value"in o&&(o.writable=true),Object.defineProperty(t,o.key,o);}}return function(t,n,a){return n&&defineProperties(t.prototype,n),a&&defineProperties(t,a),t}}(),X=function _taggedTemplateLiteral(t,n){return Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(n)}}))}(["",""],["",""]);var Q=function(){function TemplateTag(){for(var t=this,n=arguments.length,a=Array(n),o=0;o<n;o++)a[o]=arguments[o];return function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,TemplateTag),this.tag=function(n){for(var a=arguments.length,o=Array(a>1?a-1:0),r=1;r<a;r++)o[r-1]=arguments[r];return "function"==typeof n?t.interimTag.bind(t,n):"string"==typeof n?t.transformEndResult(n):(n=n.map(t.transformString.bind(t)),t.transformEndResult(n.reduce(t.processSubstitutions.bind(t,o))))},a.length>0&&Array.isArray(a[0])&&(a=a[0]),this.transformers=a.map((function(t){return "function"==typeof t?t():t})),this.tag}return z(TemplateTag,[{key:"interimTag",value:function interimTag(t,n){for(var a=arguments.length,o=Array(a>2?a-2:0),r=2;r<a;r++)o[r-2]=arguments[r];return this.tag(X,t.apply(void 0,[n].concat(o)))}},{key:"processSubstitutions",value:function processSubstitutions(t,n,a){var o=this.transformSubstitution(t.shift(),n);return "".concat(n,o,a)}},{key:"transformString",value:function transformString(t){return this.transformers.reduce((function cb(t,n){return n.onString?n.onString(t):t}),t)}},{key:"transformSubstitution",value:function transformSubstitution(t,n){return this.transformers.reduce((function cb(t,a){return a.onSubstitution?a.onSubstitution(t,n):t}),t)}},{key:"transformEndResult",value:function transformEndResult(t){return this.transformers.reduce((function cb(t,n){return n.onEndResult?n.onEndResult(t):t}),t)}}]),TemplateTag}(),Z=function trimResultTransformer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return {onEndResult:function onEndResult(n){if(""===t)return n.trim();if("start"===(t=t.toLowerCase())||"left"===t)return n.replace(/^\s*/,"");if("end"===t||"right"===t)return n.replace(/\s*$/,"");throw new Error("Side not supported: "+t)}}};var ee=function stripIndentTransformer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"initial";return {onEndResult:function onEndResult(n){if("initial"===t){var a=n.match(/^[^\S\n]*(?=\S)/gm),o=a&&Math.min.apply(Math,function _toConsumableArray(t){if(Array.isArray(t)){for(var n=0,a=Array(t.length);n<t.length;n++)a[n]=t[n];return a}return Array.from(t)}(a.map((function(t){return t.length}))));if(o){var r=new RegExp("^.{"+o+"}","gm");return n.replace(r,"")}return n}if("all"===t)return n.replace(/^[^\S\n]+/gm,"");throw new Error("Unknown type: "+t)}}},te=function replaceResultTransformer(t,n){return {onEndResult:function onEndResult(a){if(null==t||null==n)throw new Error("replaceResultTransformer requires at least 2 arguments.");return a.replace(t,n)}}},ne=function replaceSubstitutionTransformer(t,n){return {onSubstitution:function onSubstitution(a,o){if(null==t||null==n)throw new Error("replaceSubstitutionTransformer requires at least 2 arguments.");return null==a?a:a.toString().replace(t,n)}}},ae={separator:"",conjunction:"",serial:false},oe=function inlineArrayTransformer(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ae;return {onSubstitution:function onSubstitution(n,a){if(Array.isArray(n)){var o=n.length,r=t.separator,s=t.conjunction,i=t.serial,l=a.match(/(\n?[^\S\n]+)$/);if(n=l?n.join(r+l[1]):n.join(r+" "),s&&o>1){var u=n.lastIndexOf(r);n=n.slice(0,u)+(i?r:"")+" "+s+n.slice(u+1);}}return n}}},re=function splitStringTransformer(t){return {onSubstitution:function onSubstitution(n,a){return "string"==typeof n&&n.includes(t)&&(n=n.split(t)),n}}},se=function isValidValue(t){return null!=t&&!Number.isNaN(t)&&"boolean"!=typeof t};new Q(oe({separator:","}),ee,Z),new Q(oe({separator:",",conjunction:"and"}),ee,Z),new Q(oe({separator:",",conjunction:"or"}),ee,Z),new Q(re("\n"),(function removeNonPrintingValuesTransformer(){return {onSubstitution:function onSubstitution(t){return Array.isArray(t)?t.filter(se):se(t)?t:""}}}),oe,ee,Z),new Q(re("\n"),oe,ee,Z,ne(/&/g,"&amp;"),ne(/</g,"&lt;"),ne(/>/g,"&gt;"),ne(/"/g,"&quot;"),ne(/'/g,"&#x27;"),ne(/`/g,"&#x60;"));var ie=new Q(te(/(?:\n(?:\s*))+/g," "),Z);new Q(te(/(?:\n\s*)/g,""),Z),new Q(oe({separator:","}),te(/(?:\s+)/g," "),Z),new Q(oe({separator:",",conjunction:"or"}),te(/(?:\s+)/g," "),Z),new Q(oe({separator:",",conjunction:"and"}),te(/(?:\s+)/g," "),Z),new Q(oe,ee,Z),new Q(oe,te(/(?:\s+)/g," "),Z);var le=new Q(ee,Z);function promisifyRequest(t){return new Promise(((n,a)=>{t.oncomplete=t.onsuccess=()=>n(t.result),t.onabort=t.onerror=()=>a(t.error);}))}let ue;function defaultGetStore(){return ue||(ue=function createStore(t,n){const a=indexedDB.open(t);a.onupgradeneeded=()=>a.result.createObjectStore(n);const o=promisifyRequest(a);return (t,a)=>o.then((o=>a(o.transaction(n,t).objectStore(n))))}("keyval-store","keyval")),ue}new Q(ee("all"),Z);const db_get=async t=>await function get(t,n=defaultGetStore()){return n("readonly",(n=>promisifyRequest(n.get(t))))}(t),db_set=async(t,n)=>await function set(t,n,a=defaultGetStore()){return a("readwrite",(a=>(a.put(n,t),promisifyRequest(a.transaction))))}(t,n),db_del=async t=>await function del(t,n=defaultGetStore()){return n("readwrite",(n=>(n.delete(t),promisifyRequest(n.transaction))))}(t);
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */
	class BaseModule{}function formatMap(t,n){return t.replace(/\{([^}]+)\}/g,((t,a)=>{if(Object.prototype.hasOwnProperty.call(n,a)){const t=n[a];return null!=t?String(t):""}throw new Error(`Key '${a}' not found in valueMap.`)}))}function setValueByPath(t,n,a){for(let s=0;s<n.length-1;s++){const o=n[s];if(o.endsWith("[]")){const r=o.slice(0,-2);if(!(r in t)){if(!Array.isArray(a))throw new Error(`Value must be a list given an array path ${o}`);t[r]=Array.from({length:a.length},(()=>({})));}if(Array.isArray(t[r])){const o=t[r];if(Array.isArray(a))for(let t=0;t<o.length;t++){setValueByPath(o[t],n.slice(s+1),a[t]);}else for(const t of o)setValueByPath(t,n.slice(s+1),a);}return}if(o.endsWith("[0]")){const r=o.slice(0,-3);r in t||(t[r]=[{}]);return void setValueByPath(t[r][0],n.slice(s+1),a)}t[o]&&"object"==typeof t[o]||(t[o]={}),t=t[o];}const o=n[n.length-1],r=t[o];if(void 0!==r){if(!a||"object"==typeof a&&0===Object.keys(a).length)return;if(a===r)return;if("object"!=typeof r||"object"!=typeof a||null===r||null===a)throw new Error(`Cannot set value for an existing key. Key: ${o}`);Object.assign(r,a);}else t[o]=a;}function getValueByPath(t,n){try{if(1===n.length&&"_self"===n[0])return t;for(let a=0;a<n.length;a++){if("object"!=typeof t||null===t)return;const o=n[a];if(o.endsWith("[]")){const r=o.slice(0,-2);if(r in t){const o=t[r];if(!Array.isArray(o))return;return o.map((t=>getValueByPath(t,n.slice(a+1))))}return}t=t[o];}return t}catch(a){if(a instanceof TypeError)return;throw a}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */function tModel(t,n){if(!n||"string"!=typeof n)throw new Error("model is required and must be a string");if(t.isVertexAI()){if(n.startsWith("publishers/")||n.startsWith("projects/")||n.startsWith("models/"))return n;if(n.indexOf("/")>=0){const t=n.split("/",2);return `publishers/${t[0]}/models/${t[1]}`}return `publishers/google/models/${n}`}return n.startsWith("models/")||n.startsWith("tunedModels/")?n:`models/${n}`}function tCachesModel(t,n){const a=tModel(t,n);return a?a.startsWith("publishers/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/${a}`:a.startsWith("models/")&&t.isVertexAI()?`projects/${t.getProject()}/locations/${t.getLocation()}/publishers/google/${a}`:a:""}function tPart(t,n){if(null==n)throw new Error("PartUnion is required");if("object"==typeof n)return n;if("string"==typeof n)return {text:n};throw new Error("Unsupported part type: "+typeof n)}function tParts(t,n){if(null==n||Array.isArray(n)&&0===n.length)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map((t=>tPart(0,t))):[tPart(0,n)]}function _isContent(t){return null!=t&&"object"==typeof t&&"parts"in t&&Array.isArray(t.parts)}function _isUserPart(t){return null!=t&&!function _isFunctionCallPart(t){return null!=t&&"object"==typeof t&&"functionCall"in t}(t)}function _areUserParts(t){return !(null==t||Array.isArray(t)&&0===t.length)&&t.every(_isUserPart)}function tContent(t,n){if(null==n)throw new Error("ContentUnion is required");return _isContent(n)?n:_isUserPart(n)?{role:"user",parts:tParts(0,n)}:{role:"model",parts:tParts(0,n)}}function tContentsForEmbed(t,n){if(!n)return [];if(t.isVertexAI()&&Array.isArray(n))return n.flatMap((t=>{const n=tContent(0,t);return n.parts&&n.parts.length>0&&void 0!==n.parts[0].text?[n.parts[0].text]:[]}));if(t.isVertexAI()){const t=tContent(0,n);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]}return Array.isArray(n)?n.map((t=>tContent(0,t))):[tContent(0,n)]}function _appendAccumulatedPartsAsContent(t,n,a){0!==a.length&&(_areUserParts(a)?n.push({role:"user",parts:tParts(0,a)}):n.push({role:"model",parts:tParts(0,a)}),a.length=0);}function _handleCurrentPart(t,n,a,o){_isUserPart(o)===_areUserParts(a)||(_appendAccumulatedPartsAsContent(0,n,a),a.length=0),a.push(o);}function tContents(t,n){if(null==n||Array.isArray(n)&&0===n.length)throw new Error("contents are required");if(!Array.isArray(n))return [tContent(0,n)];const a=[],o=[];for(const r of n)if(_isContent(r))_appendAccumulatedPartsAsContent(0,a,o),a.push(r);else if("string"==typeof r||"object"==typeof r&&!Array.isArray(r))_handleCurrentPart(0,a,o,r);else {if(!Array.isArray(r))throw new Error("Unsupported content type: "+typeof r);_appendAccumulatedPartsAsContent(0,a,o),a.push({role:"user",parts:tParts(0,r)});}return _appendAccumulatedPartsAsContent(0,a,o),a}function processSchema(t,n){if(!t.isVertexAI()&&"default"in n)throw new Error("Default value is not supported in the response schema for the Gemini API.");if("anyOf"in n&&void 0!==n.anyOf)for(const a of n.anyOf)processSchema(t,a);if("items"in n&&void 0!==n.items&&processSchema(t,n.items),"properties"in n&&void 0!==n.properties)for(const a of Object.values(n.properties))processSchema(t,a);}function tSchema(t,n){return processSchema(t,n),n}function tSpeechConfig(t,n){if("object"==typeof n&&"voiceConfig"in n)return n;if("string"==typeof n)return {voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error("Unsupported speechConfig type: "+typeof n)}function tTool(t,n){return n}function tTools(t,n){if(!Array.isArray(n))throw new Error("tool is required and must be an array of Tools");return n}function tCachedContentName(t,n){if("string"!=typeof n)throw new Error("name must be a string");return function resourceName(t,n,a,o=1){const r=!n.startsWith(`${a}/`)&&n.split("/").length===o;return t.isVertexAI()?n.startsWith("projects/")?n:n.startsWith("locations/")?`projects/${t.getProject()}/${n}`:n.startsWith(`${a}/`)?`projects/${t.getProject()}/locations/${t.getLocation()}/${n}`:r?`projects/${t.getProject()}/locations/${t.getLocation()}/${a}/${n}`:n:r?`${a}/${n}`:n}(t,n,"cachedContents")}function tBytes(t,n){if("string"!=typeof n)throw new Error("fromImageBytes must be a string");return n}function tFileName(t,n){if("string"!=typeof n)throw new Error("fromName must be a string");return n.startsWith("files/")?n.split("files/")[1]:n}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */function contentToMldev$1(t,n){const a={},o=getValueByPath(n,["parts"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["parts"],o.map((t=>function partToMldev$1(t,n){const a={};if(void 0!==getValueByPath(n,["videoMetadata"]))throw new Error("videoMetadata parameter is not supported in Gemini API.");const o=getValueByPath(n,["thought"]);null!=o&&setValueByPath(a,["thought"],o);const r=getValueByPath(n,["codeExecutionResult"]);null!=r&&setValueByPath(a,["codeExecutionResult"],r);const s=getValueByPath(n,["executableCode"]);null!=s&&setValueByPath(a,["executableCode"],s);const i=getValueByPath(n,["fileData"]);null!=i&&setValueByPath(a,["fileData"],i);const l=getValueByPath(n,["functionCall"]);null!=l&&setValueByPath(a,["functionCall"],l);const u=getValueByPath(n,["functionResponse"]);null!=u&&setValueByPath(a,["functionResponse"],u);const c=getValueByPath(n,["inlineData"]);null!=c&&setValueByPath(a,["inlineData"],c);const h=getValueByPath(n,["text"]);return null!=h&&setValueByPath(a,["text"],h),a}(0,t)))):setValueByPath(a,["parts"],o));const r=getValueByPath(n,["role"]);return null!=r&&setValueByPath(a,["role"],r),a}function googleSearchRetrievalToMldev$1(t,n){const a={},o=getValueByPath(n,["dynamicRetrievalConfig"]);return null!=o&&setValueByPath(a,["dynamicRetrievalConfig"],function dynamicRetrievalConfigToMldev$1(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["dynamicThreshold"]);return null!=r&&setValueByPath(a,["dynamicThreshold"],r),a}(0,o)),a}function toolToMldev$1(t,n){const a={},o=getValueByPath(n,["functionDeclarations"]);if(null!=o&&(Array.isArray(o)?setValueByPath(a,["functionDeclarations"],o.map((t=>function functionDeclarationToMldev$1(t,n){const a={};if(void 0!==getValueByPath(n,["response"]))throw new Error("response parameter is not supported in Gemini API.");const o=getValueByPath(n,["description"]);null!=o&&setValueByPath(a,["description"],o);const r=getValueByPath(n,["name"]);null!=r&&setValueByPath(a,["name"],r);const s=getValueByPath(n,["parameters"]);return null!=s&&setValueByPath(a,["parameters"],s),a}(0,t)))):setValueByPath(a,["functionDeclarations"],o)),void 0!==getValueByPath(n,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");null!=getValueByPath(n,["googleSearch"])&&setValueByPath(a,["googleSearch"],{});const r=getValueByPath(n,["googleSearchRetrieval"]);null!=r&&setValueByPath(a,["googleSearchRetrieval"],googleSearchRetrievalToMldev$1(0,r));const s=getValueByPath(n,["codeExecution"]);return null!=s&&setValueByPath(a,["codeExecution"],s),a}function toolConfigToMldev$1(t,n){const a={},o=getValueByPath(n,["functionCallingConfig"]);return null!=o&&setValueByPath(a,["functionCallingConfig"],function functionCallingConfigToMldev$1(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["allowedFunctionNames"]);return null!=r&&setValueByPath(a,["allowedFunctionNames"],r),a}(0,o)),a}function createCachedContentParametersToMldev(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["model"],tCachesModel(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],function createCachedContentConfigToMldev(t,n,a){const o=getValueByPath(n,["ttl"]);void 0!==a&&null!=o&&setValueByPath(a,["ttl"],o);const r=getValueByPath(n,["expireTime"]);void 0!==a&&null!=r&&setValueByPath(a,["expireTime"],r);const s=getValueByPath(n,["displayName"]);void 0!==a&&null!=s&&setValueByPath(a,["displayName"],s);const i=getValueByPath(n,["contents"]);void 0!==a&&null!=i&&(Array.isArray(i)?setValueByPath(a,["contents"],tContents(0,tContents(0,i).map((t=>contentToMldev$1(0,t))))):setValueByPath(a,["contents"],tContents(0,i)));const l=getValueByPath(n,["systemInstruction"]);void 0!==a&&null!=l&&setValueByPath(a,["systemInstruction"],contentToMldev$1(0,tContent(0,l)));const u=getValueByPath(n,["tools"]);void 0!==a&&null!=u&&(Array.isArray(u)?setValueByPath(a,["tools"],u.map((t=>toolToMldev$1(0,t)))):setValueByPath(a,["tools"],u));const c=getValueByPath(n,["toolConfig"]);return void 0!==a&&null!=c&&setValueByPath(a,["toolConfig"],toolConfigToMldev$1(0,c)),{}}(0,r,a)),a}function updateCachedContentParametersToMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","name"],tCachedContentName(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],function updateCachedContentConfigToMldev(t,n,a){const o=getValueByPath(n,["ttl"]);void 0!==a&&null!=o&&setValueByPath(a,["ttl"],o);const r=getValueByPath(n,["expireTime"]);return void 0!==a&&null!=r&&setValueByPath(a,["expireTime"],r),{}}(0,r,a)),a}function listCachedContentsParametersToMldev(t,n){const a={},o=getValueByPath(n,["config"]);return null!=o&&setValueByPath(a,["config"],function listCachedContentsConfigToMldev(t,n,a){const o=getValueByPath(n,["pageSize"]);void 0!==a&&null!=o&&setValueByPath(a,["_query","pageSize"],o);const r=getValueByPath(n,["pageToken"]);return void 0!==a&&null!=r&&setValueByPath(a,["_query","pageToken"],r),{}}(0,o,a)),a}function contentToVertex$1(t,n){const a={},o=getValueByPath(n,["parts"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["parts"],o.map((t=>function partToVertex$1(t,n){const a={},o=getValueByPath(n,["videoMetadata"]);null!=o&&setValueByPath(a,["videoMetadata"],o);const r=getValueByPath(n,["thought"]);null!=r&&setValueByPath(a,["thought"],r);const s=getValueByPath(n,["codeExecutionResult"]);null!=s&&setValueByPath(a,["codeExecutionResult"],s);const i=getValueByPath(n,["executableCode"]);null!=i&&setValueByPath(a,["executableCode"],i);const l=getValueByPath(n,["fileData"]);null!=l&&setValueByPath(a,["fileData"],l);const u=getValueByPath(n,["functionCall"]);null!=u&&setValueByPath(a,["functionCall"],u);const c=getValueByPath(n,["functionResponse"]);null!=c&&setValueByPath(a,["functionResponse"],c);const h=getValueByPath(n,["inlineData"]);null!=h&&setValueByPath(a,["inlineData"],h);const d=getValueByPath(n,["text"]);return null!=d&&setValueByPath(a,["text"],d),a}(0,t)))):setValueByPath(a,["parts"],o));const r=getValueByPath(n,["role"]);return null!=r&&setValueByPath(a,["role"],r),a}function functionDeclarationToVertex$1(t,n){const a={},o=getValueByPath(n,["response"]);null!=o&&setValueByPath(a,["response"],function schemaToVertex$1(t,n){const a={},o=getValueByPath(n,["example"]);null!=o&&setValueByPath(a,["example"],o);const r=getValueByPath(n,["pattern"]);null!=r&&setValueByPath(a,["pattern"],r);const s=getValueByPath(n,["default"]);null!=s&&setValueByPath(a,["default"],s);const i=getValueByPath(n,["maxLength"]);null!=i&&setValueByPath(a,["maxLength"],i);const l=getValueByPath(n,["minLength"]);null!=l&&setValueByPath(a,["minLength"],l);const u=getValueByPath(n,["minProperties"]);null!=u&&setValueByPath(a,["minProperties"],u);const c=getValueByPath(n,["maxProperties"]);null!=c&&setValueByPath(a,["maxProperties"],c);const h=getValueByPath(n,["anyOf"]);null!=h&&setValueByPath(a,["anyOf"],h);const d=getValueByPath(n,["description"]);null!=d&&setValueByPath(a,["description"],d);const p=getValueByPath(n,["enum"]);null!=p&&setValueByPath(a,["enum"],p);const g=getValueByPath(n,["format"]);null!=g&&setValueByPath(a,["format"],g);const P=getValueByPath(n,["items"]);null!=P&&setValueByPath(a,["items"],P);const V=getValueByPath(n,["maxItems"]);null!=V&&setValueByPath(a,["maxItems"],V);const B=getValueByPath(n,["maximum"]);null!=B&&setValueByPath(a,["maximum"],B);const v=getValueByPath(n,["minItems"]);null!=v&&setValueByPath(a,["minItems"],v);const C=getValueByPath(n,["minimum"]);null!=C&&setValueByPath(a,["minimum"],C);const b=getValueByPath(n,["nullable"]);null!=b&&setValueByPath(a,["nullable"],b);const E=getValueByPath(n,["properties"]);null!=E&&setValueByPath(a,["properties"],E);const T=getValueByPath(n,["propertyOrdering"]);null!=T&&setValueByPath(a,["propertyOrdering"],T);const A=getValueByPath(n,["required"]);null!=A&&setValueByPath(a,["required"],A);const w=getValueByPath(n,["title"]);null!=w&&setValueByPath(a,["title"],w);const S=getValueByPath(n,["type"]);return null!=S&&setValueByPath(a,["type"],S),a}(0,o));const r=getValueByPath(n,["description"]);null!=r&&setValueByPath(a,["description"],r);const s=getValueByPath(n,["name"]);null!=s&&setValueByPath(a,["name"],s);const i=getValueByPath(n,["parameters"]);return null!=i&&setValueByPath(a,["parameters"],i),a}function googleSearchRetrievalToVertex$1(t,n){const a={},o=getValueByPath(n,["dynamicRetrievalConfig"]);return null!=o&&setValueByPath(a,["dynamicRetrievalConfig"],function dynamicRetrievalConfigToVertex$1(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["dynamicThreshold"]);return null!=r&&setValueByPath(a,["dynamicThreshold"],r),a}(0,o)),a}function toolConfigToVertex$1(t,n){const a={},o=getValueByPath(n,["functionCallingConfig"]);return null!=o&&setValueByPath(a,["functionCallingConfig"],function functionCallingConfigToVertex$1(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["allowedFunctionNames"]);return null!=r&&setValueByPath(a,["allowedFunctionNames"],r),a}(0,o)),a}function createCachedContentConfigToVertex(t,n,a){const o=getValueByPath(n,["ttl"]);void 0!==a&&null!=o&&setValueByPath(a,["ttl"],o);const r=getValueByPath(n,["expireTime"]);void 0!==a&&null!=r&&setValueByPath(a,["expireTime"],r);const s=getValueByPath(n,["displayName"]);void 0!==a&&null!=s&&setValueByPath(a,["displayName"],s);const i=getValueByPath(n,["contents"]);void 0!==a&&null!=i&&(Array.isArray(i)?setValueByPath(a,["contents"],tContents(0,tContents(0,i).map((t=>contentToVertex$1(0,t))))):setValueByPath(a,["contents"],tContents(0,i)));const l=getValueByPath(n,["systemInstruction"]);void 0!==a&&null!=l&&setValueByPath(a,["systemInstruction"],contentToVertex$1(0,tContent(0,l)));const u=getValueByPath(n,["tools"]);void 0!==a&&null!=u&&(Array.isArray(u)?setValueByPath(a,["tools"],u.map((t=>function toolToVertex$1(t,n){const a={},o=getValueByPath(n,["functionDeclarations"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["functionDeclarations"],o.map((t=>functionDeclarationToVertex$1(0,t)))):setValueByPath(a,["functionDeclarations"],o));const r=getValueByPath(n,["retrieval"]);null!=r&&setValueByPath(a,["retrieval"],r),null!=getValueByPath(n,["googleSearch"])&&setValueByPath(a,["googleSearch"],{});const s=getValueByPath(n,["googleSearchRetrieval"]);null!=s&&setValueByPath(a,["googleSearchRetrieval"],googleSearchRetrievalToVertex$1(0,s));const i=getValueByPath(n,["codeExecution"]);return null!=i&&setValueByPath(a,["codeExecution"],i),a}(0,t)))):setValueByPath(a,["tools"],u));const c=getValueByPath(n,["toolConfig"]);return void 0!==a&&null!=c&&setValueByPath(a,["toolConfig"],toolConfigToVertex$1(0,c)),{}}function updateCachedContentParametersToVertex(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","name"],tCachedContentName(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],function updateCachedContentConfigToVertex(t,n,a){const o=getValueByPath(n,["ttl"]);void 0!==a&&null!=o&&setValueByPath(a,["ttl"],o);const r=getValueByPath(n,["expireTime"]);return void 0!==a&&null!=r&&setValueByPath(a,["expireTime"],r),{}}(0,r,a)),a}function listCachedContentsParametersToVertex(t,n){const a={},o=getValueByPath(n,["config"]);return null!=o&&setValueByPath(a,["config"],function listCachedContentsConfigToVertex(t,n,a){const o=getValueByPath(n,["pageSize"]);void 0!==a&&null!=o&&setValueByPath(a,["_query","pageSize"],o);const r=getValueByPath(n,["pageToken"]);return void 0!==a&&null!=r&&setValueByPath(a,["_query","pageToken"],r),{}}(0,o,a)),a}function cachedContentFromMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["name"],o);const r=getValueByPath(n,["displayName"]);null!=r&&setValueByPath(a,["displayName"],r);const s=getValueByPath(n,["model"]);null!=s&&setValueByPath(a,["model"],s);const i=getValueByPath(n,["createTime"]);null!=i&&setValueByPath(a,["createTime"],i);const l=getValueByPath(n,["updateTime"]);null!=l&&setValueByPath(a,["updateTime"],l);const u=getValueByPath(n,["expireTime"]);null!=u&&setValueByPath(a,["expireTime"],u);const c=getValueByPath(n,["usageMetadata"]);return null!=c&&setValueByPath(a,["usageMetadata"],c),a}function cachedContentFromVertex(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["name"],o);const r=getValueByPath(n,["displayName"]);null!=r&&setValueByPath(a,["displayName"],r);const s=getValueByPath(n,["model"]);null!=s&&setValueByPath(a,["model"],s);const i=getValueByPath(n,["createTime"]);null!=i&&setValueByPath(a,["createTime"],i);const l=getValueByPath(n,["updateTime"]);null!=l&&setValueByPath(a,["updateTime"],l);const u=getValueByPath(n,["expireTime"]);null!=u&&setValueByPath(a,["expireTime"],u);const c=getValueByPath(n,["usageMetadata"]);return null!=c&&setValueByPath(a,["usageMetadata"],c),a}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */
	var ce,he,de,pe,ge,ye,me,fe,Pe,Ve,Be,ve,Ce,_e,be,Ee,Te,Ae,we,Se,Ne,Oe,xe,Ie,Re;!function(t){t.PAGED_ITEM_BATCH_JOBS="batchJobs",t.PAGED_ITEM_MODELS="models",t.PAGED_ITEM_TUNING_JOBS="tuningJobs",t.PAGED_ITEM_FILES="files",t.PAGED_ITEM_CACHED_CONTENTS="cachedContents";}(ce||(ce={}));class Pager{constructor(t,n,a,o){this.pageInternal=[],this.paramsInternal={},this.requestInternal=n,this.init(t,a,o);}init(t,n,a){var o,r;this.nameInternal=t,this.pageInternal=n[this.nameInternal]||[],this.idxInternal=0;let s={config:{}};s=a?"object"==typeof a?Object.assign({},a):a:{config:{}},s.config&&(s.config.pageToken=n.nextPageToken),this.paramsInternal=s,this.pageInternalSize=null!==(r=null===(o=s.config)||void 0===o?void 0:o.pageSize)&&void 0!==r?r:this.pageInternal.length;}initNextPage(t){this.init(this.nameInternal,t,this.paramsInternal);}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(t){return this.pageInternal[t]}[Symbol.asyncIterator](){return {next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return {value:void 0,done:true};await this.nextPage();}const t=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:t,done:false}},return:async()=>({value:void 0,done:true})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const t=await this.requestInternal(this.params);return this.initNextPage(t),this.page}hasNextPage(){var t;return void 0!==(null===(t=this.params.config)||void 0===t?void 0:t.pageToken)}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */!function(t){t.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",t.OUTCOME_OK="OUTCOME_OK",t.OUTCOME_FAILED="OUTCOME_FAILED",t.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED";}(he||(he={})),function(t){t.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",t.PYTHON="PYTHON";}(de||(de={})),function(t){t.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",t.STRING="STRING",t.NUMBER="NUMBER",t.INTEGER="INTEGER",t.BOOLEAN="BOOLEAN",t.ARRAY="ARRAY",t.OBJECT="OBJECT";}(pe||(pe={})),function(t){t.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",t.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",t.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",t.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",t.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",t.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY";}(ge||(ge={})),function(t){t.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",t.SEVERITY="SEVERITY",t.PROBABILITY="PROBABILITY";}(ye||(ye={})),function(t){t.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE",t.OFF="OFF";}(me||(me={})),function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC";}(fe||(fe={})),function(t){t.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",t.STOP="STOP",t.MAX_TOKENS="MAX_TOKENS",t.SAFETY="SAFETY",t.RECITATION="RECITATION",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT",t.SPII="SPII",t.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",t.IMAGE_SAFETY="IMAGE_SAFETY";}(Pe||(Pe={})),function(t){t.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",t.NEGLIGIBLE="NEGLIGIBLE",t.LOW="LOW",t.MEDIUM="MEDIUM",t.HIGH="HIGH";}(Ve||(Ve={})),function(t){t.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",t.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",t.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",t.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",t.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH";}(Be||(Be={})),function(t){t.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",t.SAFETY="SAFETY",t.OTHER="OTHER",t.BLOCKLIST="BLOCKLIST",t.PROHIBITED_CONTENT="PROHIBITED_CONTENT";}(ve||(ve={})),function(t){t.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",t.TEXT="TEXT",t.IMAGE="IMAGE",t.AUDIO="AUDIO";}(Ce||(Ce={})),function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.ACTIVE="ACTIVE",t.ERROR="ERROR";}(_e||(_e={})),function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.MODE_DYNAMIC="MODE_DYNAMIC";}(be||(be={})),function(t){t.MODE_UNSPECIFIED="MODE_UNSPECIFIED",t.AUTO="AUTO",t.ANY="ANY",t.NONE="NONE";}(Ee||(Ee={})),function(t){t.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",t.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",t.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",t.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH";}(Te||(Te={})),function(t){t.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",t.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",t.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",t.BLOCK_NONE="BLOCK_NONE";}(Ae||(Ae={})),function(t){t.DONT_ALLOW="DONT_ALLOW",t.ALLOW_ADULT="ALLOW_ADULT",t.ALLOW_ALL="ALLOW_ALL";}(we||(we={})),function(t){t.auto="auto",t.en="en",t.ja="ja",t.ko="ko",t.hi="hi";}(Se||(Se={})),function(t){t.STATE_UNSPECIFIED="STATE_UNSPECIFIED",t.PROCESSING="PROCESSING",t.ACTIVE="ACTIVE",t.FAILED="FAILED";}(Ne||(Ne={})),function(t){t.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",t.UPLOADED="UPLOADED",t.GENERATED="GENERATED";}(Oe||(Oe={})),function(t){t.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",t.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",t.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",t.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",t.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC";}(xe||(xe={})),function(t){t.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",t.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",t.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",t.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH";}(Ie||(Ie={})),function(t){t.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",t.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",t.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",t.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT";}(Re||(Re={}));class GenerateContentResponse{get text(){var t,n,a,o,r,s,i,l;if(0===(null===(o=null===(a=null===(n=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===n?void 0:n.content)||void 0===a?void 0:a.parts)||void 0===o?void 0:o.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let u="",c=false;const h=[];for(const d of null!==(l=null===(i=null===(s=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===s?void 0:s.content)||void 0===i?void 0:i.parts)&&void 0!==l?l:[]){for(const[t,n]of Object.entries(d))"text"===t||"thought"===t||null===n&&void 0===n||h.push(t);if("string"==typeof d.text){if("boolean"==typeof d.thought&&d.thought)continue;c=true,u+=d.text;}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),c?u:void 0}get functionCalls(){var t,n,a,o,r,s,i,l;if(0===(null===(o=null===(a=null===(n=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===n?void 0:n.content)||void 0===a?void 0:a.parts)||void 0===o?void 0:o.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const u=null===(l=null===(i=null===(s=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===s?void 0:s.content)||void 0===i?void 0:i.parts)||void 0===l?void 0:l.filter((t=>t.functionCall)).map((t=>t.functionCall)).filter((t=>void 0!==t));return 0!==(null==u?void 0:u.length)?u:void 0}get executableCode(){var t,n,a,o,r,s,i,l,u;if(0===(null===(o=null===(a=null===(n=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===n?void 0:n.content)||void 0===a?void 0:a.parts)||void 0===o?void 0:o.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const c=null===(l=null===(i=null===(s=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===s?void 0:s.content)||void 0===i?void 0:i.parts)||void 0===l?void 0:l.filter((t=>t.executableCode)).map((t=>t.executableCode)).filter((t=>void 0!==t));return 0!==(null==c?void 0:c.length)?null===(u=null==c?void 0:c[0])||void 0===u?void 0:u.code:void 0}get codeExecutionResult(){var t,n,a,o,r,s,i,l,u;if(0===(null===(o=null===(a=null===(n=null===(t=this.candidates)||void 0===t?void 0:t[0])||void 0===n?void 0:n.content)||void 0===a?void 0:a.parts)||void 0===o?void 0:o.length))return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const c=null===(l=null===(i=null===(s=null===(r=this.candidates)||void 0===r?void 0:r[0])||void 0===s?void 0:s.content)||void 0===i?void 0:i.parts)||void 0===l?void 0:l.filter((t=>t.codeExecutionResult)).map((t=>t.codeExecutionResult)).filter((t=>void 0!==t));return 0!==(null==c?void 0:c.length)?null===(u=null==c?void 0:c[0])||void 0===u?void 0:u.output:void 0}}class EmbedContentResponse{}class GenerateImagesResponse{}class CountTokensResponse{}class ComputeTokensResponse{}class DeleteCachedContentResponse{}class ListCachedContentsResponse{}class ListFilesResponse{}class HttpResponse{constructor(t){const n={};for(const a of t.headers.entries())n[a[0]]=a[1];this.headers=n,this.responseInternal=t;}json(){return this.responseInternal.json()}}class CreateFileResponse{}class DeleteFileResponse{}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */class Caches extends BaseModule{constructor(t){super(),this.apiClient=t,this.list=async(t={})=>new Pager(ce.PAGED_ITEM_CACHED_CONTENTS,(t=>this.listInternal(t)),await this.listInternal(t),t);}async create(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=function createCachedContentParametersToVertex(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["model"],tCachesModel(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],createCachedContentConfigToVertex(0,r,a)),a}(this.apiClient,t);return r=formatMap("cachedContents",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>cachedContentFromVertex(this.apiClient,t)))}{const n=createCachedContentParametersToMldev(this.apiClient,t);return r=formatMap("cachedContents",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>cachedContentFromMldev(this.apiClient,t)))}}async get(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=function getCachedContentParametersToVertex(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","name"],tCachedContentName(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return r=formatMap("{name}",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>cachedContentFromVertex(this.apiClient,t)))}{const n=function getCachedContentParametersToMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","name"],tCachedContentName(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return r=formatMap("{name}",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>cachedContentFromMldev(this.apiClient,t)))}}async delete(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=function deleteCachedContentParametersToVertex(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","name"],tCachedContentName(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return r=formatMap("{name}",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((()=>{const t={},n=new DeleteCachedContentResponse;return Object.assign(n,t),n}))}{const n=function deleteCachedContentParametersToMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","name"],tCachedContentName(t,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return r=formatMap("{name}",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"DELETE",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((()=>{const t={},n=new DeleteCachedContentResponse;return Object.assign(n,t),n}))}}async update(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=updateCachedContentParametersToVertex(this.apiClient,t);return r=formatMap("{name}",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"PATCH",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>cachedContentFromVertex(this.apiClient,t)))}{const n=updateCachedContentParametersToMldev(this.apiClient,t);return r=formatMap("{name}",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"PATCH",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>cachedContentFromMldev(this.apiClient,t)))}}async listInternal(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=listCachedContentsParametersToVertex(this.apiClient,t);return r=formatMap("cachedContents",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"GET",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>{const n=function listCachedContentsResponseFromVertex(t,n){const a={},o=getValueByPath(n,["nextPageToken"]);null!=o&&setValueByPath(a,["nextPageToken"],o);const r=getValueByPath(n,["cachedContents"]);return null!=r&&(Array.isArray(r)?setValueByPath(a,["cachedContents"],r.map((t=>cachedContentFromVertex(0,t)))):setValueByPath(a,["cachedContents"],r)),a}(this.apiClient,t),a=new ListCachedContentsResponse;return Object.assign(a,n),a}))}{const n=listCachedContentsParametersToMldev(this.apiClient,t);return r=formatMap("cachedContents",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"GET",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>{const n=function listCachedContentsResponseFromMldev(t,n){const a={},o=getValueByPath(n,["nextPageToken"]);null!=o&&setValueByPath(a,["nextPageToken"],o);const r=getValueByPath(n,["cachedContents"]);return null!=r&&(Array.isArray(r)?setValueByPath(a,["cachedContents"],r.map((t=>cachedContentFromMldev(0,t)))):setValueByPath(a,["cachedContents"],r)),a}(this.apiClient,t),a=new ListCachedContentsResponse;return Object.assign(a,n),a}))}}}function __values(t){var n="function"==typeof Symbol&&Symbol.iterator,a=n&&t[n],o=0;if(a)return a.call(t);if(t&&"number"==typeof t.length)return {next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function __await(t){return this instanceof __await?(this.v=t,this):new __await(t)}function __asyncGenerator(t,n,a){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o,r=a.apply(t,n||[]),s=[];return o=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),verb("next"),verb("throw"),verb("return",(function awaitReturn(t){return function(n){return Promise.resolve(n).then(t,reject)}})),o[Symbol.asyncIterator]=function(){return this},o;function verb(t,n){r[t]&&(o[t]=function(n){return new Promise((function(a,o){s.push([t,n,a,o])>1||resume(t,n);}))},n&&(o[t]=n(o[t])));}function resume(t,n){try{!function step(t){t.value instanceof __await?Promise.resolve(t.value.v).then(fulfill,reject):settle(s[0][2],t);}(r[t](n));}catch(e){settle(s[0][3],e);}}function fulfill(t){resume("next",t);}function reject(t){resume("throw",t);}function settle(t,n){t(n),s.shift(),s.length&&resume(s[0][0],s[0][1]);}}function __asyncValues(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,a=t[Symbol.asyncIterator];return a?a.call(t):(t=__values(t),n={},verb("next"),verb("throw"),verb("return"),n[Symbol.asyncIterator]=function(){return this},n);function verb(a){n[a]=t[a]&&function(n){return new Promise((function(o,r){(function settle(t,n,a,o){Promise.resolve(o).then((function(n){t({value:n,done:a});}),n);})(o,r,(n=t[a](n)).done,n.value);}))};}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */
	function isValidResponse(t){var n;if(null==t.candidates||0===t.candidates.length)return  false;const a=null===(n=t.candidates[0])||void 0===n?void 0:n.content;return void 0!==a&&isValidContent(a)}function isValidContent(t){if(void 0===t.parts||0===t.parts.length)return  false;for(const n of t.parts){if(void 0===n||0===Object.keys(n).length)return  false;if(void 0!==n.text&&""===n.text)return  false}return  true}"function"==typeof SuppressedError&&SuppressedError;class Chats{constructor(t,n){this.modelsModule=t,this.apiClient=n;}create(t){return new Chat(this.apiClient,this.modelsModule,t.model,t.config,t.history)}}class Chat{constructor(t,n,a,o={},r=[]){this.apiClient=t,this.modelsModule=n,this.model=a,this.config=o,this.history=r,this.sendPromise=Promise.resolve(),function validateHistory(t){if(0!==t.length){if("user"!==t[0].role)throw new Error("History must start with a user turn.");for(const n of t)if("user"!==n.role&&"model"!==n.role)throw new Error(`Role must be user or model, but got ${n.role}.`)}}(r);}async sendMessage(t){var n;await this.sendPromise;const a=tContent(this.apiClient,t.message),o=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(true).concat(a),config:null!==(n=t.config)&&void 0!==n?n:this.config});return this.sendPromise=(async()=>{var t,n;const r=null===(n=null===(t=(await o).candidates)||void 0===t?void 0:t[0])||void 0===n?void 0:n.content,s=r?[r]:[];this.recordHistory(a,s);})(),await this.sendPromise,o}async sendMessageStream(t){var n;await this.sendPromise;const a=tContent(this.apiClient,t.message),o=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(true).concat(a),config:null!==(n=t.config)&&void 0!==n?n:this.config});this.sendPromise=o.then((()=>{}));const r=await o;return this.processStreamResponse(r,a)}getHistory(t=false){return t?function extractCuratedHistory(t){if(void 0===t||0===t.length)return [];const n=[],a=t.length;let o=0,r=t[0];for(;o<a;)if("user"===t[o].role)r=t[o],o++;else {const s=[];let i=true;for(;o<a&&"model"===t[o].role;)s.push(t[o]),i&&!isValidContent(t[o])&&(i=false),o++;i&&(n.push(r),n.push(...s));}return n}(this.history):this.history}processStreamResponse(t,n){var a,o;return __asyncGenerator(this,arguments,(function*processStreamResponse_1(){var r,s,i,l;const u=[];try{for(var c,h=!0,d=__asyncValues(t);!(r=(c=yield __await(d.next())).done);h=!0){l=c.value,h=!1;const t=l;if(isValidResponse(t)){const n=null===(o=null===(a=t.candidates)||void 0===a?void 0:a[0])||void 0===o?void 0:o.content;void 0!==n&&u.push(n);}yield yield __await(t);}}catch(p){s={error:p};}finally{try{h||r||!(i=d.return)||(yield __await(i.call(d)));}finally{if(s)throw s.error}}this.recordHistory(n,u);}))}recordHistory(t,n){let a=[];n.length>0&&n.every((t=>"model"===t.role))?a=n:a.push({role:"model",parts:[]}),this.history.push(t),this.history.push(...a);}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */function contentToMldev(t,n){const a={},o=getValueByPath(n,["parts"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["parts"],o.map((t=>function partToMldev(t,n){const a={};if(void 0!==getValueByPath(n,["videoMetadata"]))throw new Error("videoMetadata parameter is not supported in Gemini API.");const o=getValueByPath(n,["thought"]);null!=o&&setValueByPath(a,["thought"],o);const r=getValueByPath(n,["codeExecutionResult"]);null!=r&&setValueByPath(a,["codeExecutionResult"],r);const s=getValueByPath(n,["executableCode"]);null!=s&&setValueByPath(a,["executableCode"],s);const i=getValueByPath(n,["fileData"]);null!=i&&setValueByPath(a,["fileData"],i);const l=getValueByPath(n,["functionCall"]);null!=l&&setValueByPath(a,["functionCall"],l);const u=getValueByPath(n,["functionResponse"]);null!=u&&setValueByPath(a,["functionResponse"],u);const c=getValueByPath(n,["inlineData"]);null!=c&&setValueByPath(a,["inlineData"],c);const h=getValueByPath(n,["text"]);return null!=h&&setValueByPath(a,["text"],h),a}(0,t)))):setValueByPath(a,["parts"],o));const r=getValueByPath(n,["role"]);return null!=r&&setValueByPath(a,["role"],r),a}function googleSearchRetrievalToMldev(t,n){const a={},o=getValueByPath(n,["dynamicRetrievalConfig"]);return null!=o&&setValueByPath(a,["dynamicRetrievalConfig"],function dynamicRetrievalConfigToMldev(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["dynamicThreshold"]);return null!=r&&setValueByPath(a,["dynamicThreshold"],r),a}(0,o)),a}function toolToMldev(t,n){const a={},o=getValueByPath(n,["functionDeclarations"]);if(null!=o&&(Array.isArray(o)?setValueByPath(a,["functionDeclarations"],o.map((t=>function functionDeclarationToMldev(t,n){const a={};if(void 0!==getValueByPath(n,["response"]))throw new Error("response parameter is not supported in Gemini API.");const o=getValueByPath(n,["description"]);null!=o&&setValueByPath(a,["description"],o);const r=getValueByPath(n,["name"]);null!=r&&setValueByPath(a,["name"],r);const s=getValueByPath(n,["parameters"]);return null!=s&&setValueByPath(a,["parameters"],s),a}(0,t)))):setValueByPath(a,["functionDeclarations"],o)),void 0!==getValueByPath(n,["retrieval"]))throw new Error("retrieval parameter is not supported in Gemini API.");null!=getValueByPath(n,["googleSearch"])&&setValueByPath(a,["googleSearch"],{});const r=getValueByPath(n,["googleSearchRetrieval"]);null!=r&&setValueByPath(a,["googleSearchRetrieval"],googleSearchRetrievalToMldev(0,r));const s=getValueByPath(n,["codeExecution"]);return null!=s&&setValueByPath(a,["codeExecution"],s),a}function toolConfigToMldev(t,n){const a={},o=getValueByPath(n,["functionCallingConfig"]);return null!=o&&setValueByPath(a,["functionCallingConfig"],function functionCallingConfigToMldev(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["allowedFunctionNames"]);return null!=r&&setValueByPath(a,["allowedFunctionNames"],r),a}(0,o)),a}function voiceConfigToMldev(t,n){const a={},o=getValueByPath(n,["prebuiltVoiceConfig"]);return null!=o&&setValueByPath(a,["prebuiltVoiceConfig"],function prebuiltVoiceConfigToMldev(t,n){const a={},o=getValueByPath(n,["voiceName"]);return null!=o&&setValueByPath(a,["voiceName"],o),a}(0,o)),a}function generateContentConfigToMldev(t,n,a){const o={},r=getValueByPath(n,["systemInstruction"]);void 0!==a&&null!=r&&setValueByPath(a,["systemInstruction"],contentToMldev(0,tContent(0,r)));const s=getValueByPath(n,["temperature"]);null!=s&&setValueByPath(o,["temperature"],s);const i=getValueByPath(n,["topP"]);null!=i&&setValueByPath(o,["topP"],i);const l=getValueByPath(n,["topK"]);null!=l&&setValueByPath(o,["topK"],l);const u=getValueByPath(n,["candidateCount"]);null!=u&&setValueByPath(o,["candidateCount"],u);const c=getValueByPath(n,["maxOutputTokens"]);null!=c&&setValueByPath(o,["maxOutputTokens"],c);const h=getValueByPath(n,["stopSequences"]);null!=h&&setValueByPath(o,["stopSequences"],h);const d=getValueByPath(n,["responseLogprobs"]);null!=d&&setValueByPath(o,["responseLogprobs"],d);const p=getValueByPath(n,["logprobs"]);null!=p&&setValueByPath(o,["logprobs"],p);const g=getValueByPath(n,["presencePenalty"]);null!=g&&setValueByPath(o,["presencePenalty"],g);const P=getValueByPath(n,["frequencyPenalty"]);null!=P&&setValueByPath(o,["frequencyPenalty"],P);const V=getValueByPath(n,["seed"]);null!=V&&setValueByPath(o,["seed"],V);const B=getValueByPath(n,["responseMimeType"]);null!=B&&setValueByPath(o,["responseMimeType"],B);const v=getValueByPath(n,["responseSchema"]);if(null!=v&&setValueByPath(o,["responseSchema"],function schemaToMldev(t,n){const a={};if(void 0!==getValueByPath(n,["example"]))throw new Error("example parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["pattern"]))throw new Error("pattern parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["default"]))throw new Error("default parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["maxLength"]))throw new Error("maxLength parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["minLength"]))throw new Error("minLength parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["minProperties"]))throw new Error("minProperties parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["maxProperties"]))throw new Error("maxProperties parameter is not supported in Gemini API.");const o=getValueByPath(n,["anyOf"]);null!=o&&setValueByPath(a,["anyOf"],o);const r=getValueByPath(n,["description"]);null!=r&&setValueByPath(a,["description"],r);const s=getValueByPath(n,["enum"]);null!=s&&setValueByPath(a,["enum"],s);const i=getValueByPath(n,["format"]);null!=i&&setValueByPath(a,["format"],i);const l=getValueByPath(n,["items"]);null!=l&&setValueByPath(a,["items"],l);const u=getValueByPath(n,["maxItems"]);null!=u&&setValueByPath(a,["maxItems"],u);const c=getValueByPath(n,["maximum"]);null!=c&&setValueByPath(a,["maximum"],c);const h=getValueByPath(n,["minItems"]);null!=h&&setValueByPath(a,["minItems"],h);const d=getValueByPath(n,["minimum"]);null!=d&&setValueByPath(a,["minimum"],d);const p=getValueByPath(n,["nullable"]);null!=p&&setValueByPath(a,["nullable"],p);const g=getValueByPath(n,["properties"]);null!=g&&setValueByPath(a,["properties"],g);const P=getValueByPath(n,["propertyOrdering"]);null!=P&&setValueByPath(a,["propertyOrdering"],P);const V=getValueByPath(n,["required"]);null!=V&&setValueByPath(a,["required"],V);const B=getValueByPath(n,["title"]);null!=B&&setValueByPath(a,["title"],B);const v=getValueByPath(n,["type"]);return null!=v&&setValueByPath(a,["type"],v),a}(0,tSchema(t,v))),void 0!==getValueByPath(n,["routingConfig"]))throw new Error("routingConfig parameter is not supported in Gemini API.");const C=getValueByPath(n,["safetySettings"]);void 0!==a&&null!=C&&(Array.isArray(C)?setValueByPath(a,["safetySettings"],C.map((t=>function safetySettingToMldev(t,n){const a={};if(void 0!==getValueByPath(n,["method"]))throw new Error("method parameter is not supported in Gemini API.");const o=getValueByPath(n,["category"]);null!=o&&setValueByPath(a,["category"],o);const r=getValueByPath(n,["threshold"]);return null!=r&&setValueByPath(a,["threshold"],r),a}(0,t)))):setValueByPath(a,["safetySettings"],C));const b=getValueByPath(n,["tools"]);void 0!==a&&null!=b&&(Array.isArray(b)?setValueByPath(a,["tools"],tTools(0,tTools(0,b).map((t=>toolToMldev(0,tTool(0,t)))))):setValueByPath(a,["tools"],tTools(0,b)));const E=getValueByPath(n,["toolConfig"]);if(void 0!==a&&null!=E&&setValueByPath(a,["toolConfig"],toolConfigToMldev(0,E)),void 0!==getValueByPath(n,["labels"]))throw new Error("labels parameter is not supported in Gemini API.");const T=getValueByPath(n,["cachedContent"]);void 0!==a&&null!=T&&setValueByPath(a,["cachedContent"],tCachedContentName(t,T));const A=getValueByPath(n,["responseModalities"]);null!=A&&setValueByPath(o,["responseModalities"],A);const w=getValueByPath(n,["mediaResolution"]);null!=w&&setValueByPath(o,["mediaResolution"],w);const S=getValueByPath(n,["speechConfig"]);if(null!=S&&setValueByPath(o,["speechConfig"],function speechConfigToMldev(t,n){const a={},o=getValueByPath(n,["voiceConfig"]);return null!=o&&setValueByPath(a,["voiceConfig"],voiceConfigToMldev(0,o)),a}(0,tSpeechConfig(0,S))),void 0!==getValueByPath(n,["audioTimestamp"]))throw new Error("audioTimestamp parameter is not supported in Gemini API.");const O=getValueByPath(n,["thinkingConfig"]);return null!=O&&setValueByPath(o,["thinkingConfig"],function thinkingConfigToMldev(t,n){const a={},o=getValueByPath(n,["includeThoughts"]);return null!=o&&setValueByPath(a,["includeThoughts"],o),a}(0,O)),o}function generateContentParametersToMldev(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&(Array.isArray(r)?setValueByPath(a,["contents"],tContents(0,tContents(0,r).map((t=>contentToMldev(0,t))))):setValueByPath(a,["contents"],tContents(0,r)));const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["generationConfig"],generateContentConfigToMldev(t,s,a)),a}function embedContentParametersToMldev(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&setValueByPath(a,["requests[]","content"],tContentsForEmbed(t,r));const s=getValueByPath(n,["config"]);null!=s&&setValueByPath(a,["config"],function embedContentConfigToMldev(t,n,a){const o=getValueByPath(n,["taskType"]);void 0!==a&&null!=o&&setValueByPath(a,["requests[]","taskType"],o);const r=getValueByPath(n,["title"]);void 0!==a&&null!=r&&setValueByPath(a,["requests[]","title"],r);const s=getValueByPath(n,["outputDimensionality"]);if(void 0!==a&&null!=s&&setValueByPath(a,["requests[]","outputDimensionality"],s),void 0!==getValueByPath(n,["mimeType"]))throw new Error("mimeType parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["autoTruncate"]))throw new Error("autoTruncate parameter is not supported in Gemini API.");return {}}(0,s,a));const i=getValueByPath(n,["model"]);return void 0!==i&&setValueByPath(a,["requests[]","model"],tModel(t,i)),a}function generateImagesParametersToMldev(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["prompt"]);null!=r&&setValueByPath(a,["instances[0]","prompt"],r);const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["config"],function generateImagesConfigToMldev(t,n,a){if(void 0!==getValueByPath(n,["outputGcsUri"]))throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["negativePrompt"]))throw new Error("negativePrompt parameter is not supported in Gemini API.");const o=getValueByPath(n,["numberOfImages"]);void 0!==a&&null!=o&&setValueByPath(a,["parameters","sampleCount"],o);const r=getValueByPath(n,["aspectRatio"]);void 0!==a&&null!=r&&setValueByPath(a,["parameters","aspectRatio"],r);const s=getValueByPath(n,["guidanceScale"]);if(void 0!==a&&null!=s&&setValueByPath(a,["parameters","guidanceScale"],s),void 0!==getValueByPath(n,["seed"]))throw new Error("seed parameter is not supported in Gemini API.");const i=getValueByPath(n,["safetyFilterLevel"]);void 0!==a&&null!=i&&setValueByPath(a,["parameters","safetySetting"],i);const l=getValueByPath(n,["personGeneration"]);void 0!==a&&null!=l&&setValueByPath(a,["parameters","personGeneration"],l);const u=getValueByPath(n,["includeSafetyAttributes"]);void 0!==a&&null!=u&&setValueByPath(a,["parameters","includeSafetyAttributes"],u);const c=getValueByPath(n,["includeRaiReason"]);void 0!==a&&null!=c&&setValueByPath(a,["parameters","includeRaiReason"],c);const h=getValueByPath(n,["language"]);void 0!==a&&null!=h&&setValueByPath(a,["parameters","language"],h);const d=getValueByPath(n,["outputMimeType"]);void 0!==a&&null!=d&&setValueByPath(a,["parameters","outputOptions","mimeType"],d);const p=getValueByPath(n,["outputCompressionQuality"]);if(void 0!==a&&null!=p&&setValueByPath(a,["parameters","outputOptions","compressionQuality"],p),void 0!==getValueByPath(n,["addWatermark"]))throw new Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["enhancePrompt"]))throw new Error("enhancePrompt parameter is not supported in Gemini API.");return {}}(0,s,a)),a}function countTokensParametersToMldev(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&(Array.isArray(r)?setValueByPath(a,["contents"],tContents(0,tContents(0,r).map((t=>contentToMldev(0,t))))):setValueByPath(a,["contents"],tContents(0,r)));const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["config"],function countTokensConfigToMldev(t,n){if(void 0!==getValueByPath(n,["systemInstruction"]))throw new Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["tools"]))throw new Error("tools parameter is not supported in Gemini API.");if(void 0!==getValueByPath(n,["generationConfig"]))throw new Error("generationConfig parameter is not supported in Gemini API.");return {}}(0,s)),a}function contentToVertex(t,n){const a={},o=getValueByPath(n,["parts"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["parts"],o.map((t=>function partToVertex(t,n){const a={},o=getValueByPath(n,["videoMetadata"]);null!=o&&setValueByPath(a,["videoMetadata"],o);const r=getValueByPath(n,["thought"]);null!=r&&setValueByPath(a,["thought"],r);const s=getValueByPath(n,["codeExecutionResult"]);null!=s&&setValueByPath(a,["codeExecutionResult"],s);const i=getValueByPath(n,["executableCode"]);null!=i&&setValueByPath(a,["executableCode"],i);const l=getValueByPath(n,["fileData"]);null!=l&&setValueByPath(a,["fileData"],l);const u=getValueByPath(n,["functionCall"]);null!=u&&setValueByPath(a,["functionCall"],u);const c=getValueByPath(n,["functionResponse"]);null!=c&&setValueByPath(a,["functionResponse"],c);const h=getValueByPath(n,["inlineData"]);null!=h&&setValueByPath(a,["inlineData"],h);const d=getValueByPath(n,["text"]);return null!=d&&setValueByPath(a,["text"],d),a}(0,t)))):setValueByPath(a,["parts"],o));const r=getValueByPath(n,["role"]);return null!=r&&setValueByPath(a,["role"],r),a}function schemaToVertex(t,n){const a={},o=getValueByPath(n,["example"]);null!=o&&setValueByPath(a,["example"],o);const r=getValueByPath(n,["pattern"]);null!=r&&setValueByPath(a,["pattern"],r);const s=getValueByPath(n,["default"]);null!=s&&setValueByPath(a,["default"],s);const i=getValueByPath(n,["maxLength"]);null!=i&&setValueByPath(a,["maxLength"],i);const l=getValueByPath(n,["minLength"]);null!=l&&setValueByPath(a,["minLength"],l);const u=getValueByPath(n,["minProperties"]);null!=u&&setValueByPath(a,["minProperties"],u);const c=getValueByPath(n,["maxProperties"]);null!=c&&setValueByPath(a,["maxProperties"],c);const h=getValueByPath(n,["anyOf"]);null!=h&&setValueByPath(a,["anyOf"],h);const d=getValueByPath(n,["description"]);null!=d&&setValueByPath(a,["description"],d);const p=getValueByPath(n,["enum"]);null!=p&&setValueByPath(a,["enum"],p);const g=getValueByPath(n,["format"]);null!=g&&setValueByPath(a,["format"],g);const P=getValueByPath(n,["items"]);null!=P&&setValueByPath(a,["items"],P);const V=getValueByPath(n,["maxItems"]);null!=V&&setValueByPath(a,["maxItems"],V);const B=getValueByPath(n,["maximum"]);null!=B&&setValueByPath(a,["maximum"],B);const v=getValueByPath(n,["minItems"]);null!=v&&setValueByPath(a,["minItems"],v);const C=getValueByPath(n,["minimum"]);null!=C&&setValueByPath(a,["minimum"],C);const b=getValueByPath(n,["nullable"]);null!=b&&setValueByPath(a,["nullable"],b);const E=getValueByPath(n,["properties"]);null!=E&&setValueByPath(a,["properties"],E);const T=getValueByPath(n,["propertyOrdering"]);null!=T&&setValueByPath(a,["propertyOrdering"],T);const A=getValueByPath(n,["required"]);null!=A&&setValueByPath(a,["required"],A);const w=getValueByPath(n,["title"]);null!=w&&setValueByPath(a,["title"],w);const S=getValueByPath(n,["type"]);return null!=S&&setValueByPath(a,["type"],S),a}function googleSearchRetrievalToVertex(t,n){const a={},o=getValueByPath(n,["dynamicRetrievalConfig"]);return null!=o&&setValueByPath(a,["dynamicRetrievalConfig"],function dynamicRetrievalConfigToVertex(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["dynamicThreshold"]);return null!=r&&setValueByPath(a,["dynamicThreshold"],r),a}(0,o)),a}function toolToVertex(t,n){const a={},o=getValueByPath(n,["functionDeclarations"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["functionDeclarations"],o.map((t=>function functionDeclarationToVertex(t,n){const a={},o=getValueByPath(n,["response"]);null!=o&&setValueByPath(a,["response"],schemaToVertex(0,o));const r=getValueByPath(n,["description"]);null!=r&&setValueByPath(a,["description"],r);const s=getValueByPath(n,["name"]);null!=s&&setValueByPath(a,["name"],s);const i=getValueByPath(n,["parameters"]);return null!=i&&setValueByPath(a,["parameters"],i),a}(0,t)))):setValueByPath(a,["functionDeclarations"],o));const r=getValueByPath(n,["retrieval"]);null!=r&&setValueByPath(a,["retrieval"],r);null!=getValueByPath(n,["googleSearch"])&&setValueByPath(a,["googleSearch"],{});const s=getValueByPath(n,["googleSearchRetrieval"]);null!=s&&setValueByPath(a,["googleSearchRetrieval"],googleSearchRetrievalToVertex(0,s));const i=getValueByPath(n,["codeExecution"]);return null!=i&&setValueByPath(a,["codeExecution"],i),a}function toolConfigToVertex(t,n){const a={},o=getValueByPath(n,["functionCallingConfig"]);return null!=o&&setValueByPath(a,["functionCallingConfig"],function functionCallingConfigToVertex(t,n){const a={},o=getValueByPath(n,["mode"]);null!=o&&setValueByPath(a,["mode"],o);const r=getValueByPath(n,["allowedFunctionNames"]);return null!=r&&setValueByPath(a,["allowedFunctionNames"],r),a}(0,o)),a}function voiceConfigToVertex(t,n){const a={},o=getValueByPath(n,["prebuiltVoiceConfig"]);return null!=o&&setValueByPath(a,["prebuiltVoiceConfig"],function prebuiltVoiceConfigToVertex(t,n){const a={},o=getValueByPath(n,["voiceName"]);return null!=o&&setValueByPath(a,["voiceName"],o),a}(0,o)),a}function generateContentConfigToVertex(t,n,a){const o={},r=getValueByPath(n,["systemInstruction"]);void 0!==a&&null!=r&&setValueByPath(a,["systemInstruction"],contentToVertex(0,tContent(0,r)));const s=getValueByPath(n,["temperature"]);null!=s&&setValueByPath(o,["temperature"],s);const i=getValueByPath(n,["topP"]);null!=i&&setValueByPath(o,["topP"],i);const l=getValueByPath(n,["topK"]);null!=l&&setValueByPath(o,["topK"],l);const u=getValueByPath(n,["candidateCount"]);null!=u&&setValueByPath(o,["candidateCount"],u);const c=getValueByPath(n,["maxOutputTokens"]);null!=c&&setValueByPath(o,["maxOutputTokens"],c);const h=getValueByPath(n,["stopSequences"]);null!=h&&setValueByPath(o,["stopSequences"],h);const d=getValueByPath(n,["responseLogprobs"]);null!=d&&setValueByPath(o,["responseLogprobs"],d);const p=getValueByPath(n,["logprobs"]);null!=p&&setValueByPath(o,["logprobs"],p);const g=getValueByPath(n,["presencePenalty"]);null!=g&&setValueByPath(o,["presencePenalty"],g);const P=getValueByPath(n,["frequencyPenalty"]);null!=P&&setValueByPath(o,["frequencyPenalty"],P);const V=getValueByPath(n,["seed"]);null!=V&&setValueByPath(o,["seed"],V);const B=getValueByPath(n,["responseMimeType"]);null!=B&&setValueByPath(o,["responseMimeType"],B);const v=getValueByPath(n,["responseSchema"]);null!=v&&setValueByPath(o,["responseSchema"],schemaToVertex(0,tSchema(t,v)));const C=getValueByPath(n,["routingConfig"]);null!=C&&setValueByPath(o,["routingConfig"],C);const b=getValueByPath(n,["safetySettings"]);void 0!==a&&null!=b&&(Array.isArray(b)?setValueByPath(a,["safetySettings"],b.map((t=>function safetySettingToVertex(t,n){const a={},o=getValueByPath(n,["method"]);null!=o&&setValueByPath(a,["method"],o);const r=getValueByPath(n,["category"]);null!=r&&setValueByPath(a,["category"],r);const s=getValueByPath(n,["threshold"]);return null!=s&&setValueByPath(a,["threshold"],s),a}(0,t)))):setValueByPath(a,["safetySettings"],b));const E=getValueByPath(n,["tools"]);void 0!==a&&null!=E&&(Array.isArray(E)?setValueByPath(a,["tools"],tTools(0,tTools(0,E).map((t=>toolToVertex(0,tTool(0,t)))))):setValueByPath(a,["tools"],tTools(0,E)));const T=getValueByPath(n,["toolConfig"]);void 0!==a&&null!=T&&setValueByPath(a,["toolConfig"],toolConfigToVertex(0,T));const A=getValueByPath(n,["labels"]);void 0!==a&&null!=A&&setValueByPath(a,["labels"],A);const w=getValueByPath(n,["cachedContent"]);void 0!==a&&null!=w&&setValueByPath(a,["cachedContent"],tCachedContentName(t,w));const S=getValueByPath(n,["responseModalities"]);null!=S&&setValueByPath(o,["responseModalities"],S);const O=getValueByPath(n,["mediaResolution"]);null!=O&&setValueByPath(o,["mediaResolution"],O);const x=getValueByPath(n,["speechConfig"]);null!=x&&setValueByPath(o,["speechConfig"],function speechConfigToVertex(t,n){const a={},o=getValueByPath(n,["voiceConfig"]);return null!=o&&setValueByPath(a,["voiceConfig"],voiceConfigToVertex(0,o)),a}(0,tSpeechConfig(0,x)));const I=getValueByPath(n,["audioTimestamp"]);null!=I&&setValueByPath(o,["audioTimestamp"],I);const R=getValueByPath(n,["thinkingConfig"]);return null!=R&&setValueByPath(o,["thinkingConfig"],function thinkingConfigToVertex(t,n){const a={},o=getValueByPath(n,["includeThoughts"]);return null!=o&&setValueByPath(a,["includeThoughts"],o),a}(0,R)),o}function generateContentParametersToVertex(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&(Array.isArray(r)?setValueByPath(a,["contents"],tContents(0,tContents(0,r).map((t=>contentToVertex(0,t))))):setValueByPath(a,["contents"],tContents(0,r)));const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["generationConfig"],generateContentConfigToVertex(t,s,a)),a}function embedContentParametersToVertex(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&setValueByPath(a,["instances[]","content"],tContentsForEmbed(t,r));const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["config"],function embedContentConfigToVertex(t,n,a){const o=getValueByPath(n,["taskType"]);void 0!==a&&null!=o&&setValueByPath(a,["instances[]","task_type"],o);const r=getValueByPath(n,["title"]);void 0!==a&&null!=r&&setValueByPath(a,["instances[]","title"],r);const s=getValueByPath(n,["outputDimensionality"]);void 0!==a&&null!=s&&setValueByPath(a,["parameters","outputDimensionality"],s);const i=getValueByPath(n,["mimeType"]);void 0!==a&&null!=i&&setValueByPath(a,["instances[]","mimeType"],i);const l=getValueByPath(n,["autoTruncate"]);return void 0!==a&&null!=l&&setValueByPath(a,["parameters","autoTruncate"],l),{}}(0,s,a)),a}function generateImagesParametersToVertex(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["prompt"]);null!=r&&setValueByPath(a,["instances[0]","prompt"],r);const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["config"],function generateImagesConfigToVertex(t,n,a){const o=getValueByPath(n,["outputGcsUri"]);void 0!==a&&null!=o&&setValueByPath(a,["parameters","storageUri"],o);const r=getValueByPath(n,["negativePrompt"]);void 0!==a&&null!=r&&setValueByPath(a,["parameters","negativePrompt"],r);const s=getValueByPath(n,["numberOfImages"]);void 0!==a&&null!=s&&setValueByPath(a,["parameters","sampleCount"],s);const i=getValueByPath(n,["aspectRatio"]);void 0!==a&&null!=i&&setValueByPath(a,["parameters","aspectRatio"],i);const l=getValueByPath(n,["guidanceScale"]);void 0!==a&&null!=l&&setValueByPath(a,["parameters","guidanceScale"],l);const u=getValueByPath(n,["seed"]);void 0!==a&&null!=u&&setValueByPath(a,["parameters","seed"],u);const c=getValueByPath(n,["safetyFilterLevel"]);void 0!==a&&null!=c&&setValueByPath(a,["parameters","safetySetting"],c);const h=getValueByPath(n,["personGeneration"]);void 0!==a&&null!=h&&setValueByPath(a,["parameters","personGeneration"],h);const d=getValueByPath(n,["includeSafetyAttributes"]);void 0!==a&&null!=d&&setValueByPath(a,["parameters","includeSafetyAttributes"],d);const p=getValueByPath(n,["includeRaiReason"]);void 0!==a&&null!=p&&setValueByPath(a,["parameters","includeRaiReason"],p);const g=getValueByPath(n,["language"]);void 0!==a&&null!=g&&setValueByPath(a,["parameters","language"],g);const P=getValueByPath(n,["outputMimeType"]);void 0!==a&&null!=P&&setValueByPath(a,["parameters","outputOptions","mimeType"],P);const V=getValueByPath(n,["outputCompressionQuality"]);void 0!==a&&null!=V&&setValueByPath(a,["parameters","outputOptions","compressionQuality"],V);const B=getValueByPath(n,["addWatermark"]);void 0!==a&&null!=B&&setValueByPath(a,["parameters","addWatermark"],B);const v=getValueByPath(n,["enhancePrompt"]);return void 0!==a&&null!=v&&setValueByPath(a,["parameters","enhancePrompt"],v),{}}(0,s,a)),a}function countTokensParametersToVertex(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&(Array.isArray(r)?setValueByPath(a,["contents"],tContents(0,tContents(0,r).map((t=>contentToVertex(0,t))))):setValueByPath(a,["contents"],tContents(0,r)));const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["config"],function countTokensConfigToVertex(t,n,a){const o=getValueByPath(n,["systemInstruction"]);void 0!==a&&null!=o&&setValueByPath(a,["systemInstruction"],contentToVertex(0,tContent(0,o)));const r=getValueByPath(n,["tools"]);void 0!==a&&null!=r&&(Array.isArray(r)?setValueByPath(a,["tools"],r.map((t=>toolToVertex(0,t)))):setValueByPath(a,["tools"],r));const s=getValueByPath(n,["generationConfig"]);return void 0!==a&&null!=s&&setValueByPath(a,["generationConfig"],s),{}}(0,s,a)),a}function contentFromMldev(t,n){const a={},o=getValueByPath(n,["parts"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["parts"],o.map((t=>function partFromMldev(t,n){const a={},o=getValueByPath(n,["thought"]);null!=o&&setValueByPath(a,["thought"],o);const r=getValueByPath(n,["codeExecutionResult"]);null!=r&&setValueByPath(a,["codeExecutionResult"],r);const s=getValueByPath(n,["executableCode"]);null!=s&&setValueByPath(a,["executableCode"],s);const i=getValueByPath(n,["fileData"]);null!=i&&setValueByPath(a,["fileData"],i);const l=getValueByPath(n,["functionCall"]);null!=l&&setValueByPath(a,["functionCall"],l);const u=getValueByPath(n,["functionResponse"]);null!=u&&setValueByPath(a,["functionResponse"],u);const c=getValueByPath(n,["inlineData"]);null!=c&&setValueByPath(a,["inlineData"],c);const h=getValueByPath(n,["text"]);return null!=h&&setValueByPath(a,["text"],h),a}(0,t)))):setValueByPath(a,["parts"],o));const r=getValueByPath(n,["role"]);return null!=r&&setValueByPath(a,["role"],r),a}function candidateFromMldev(t,n){const a={},o=getValueByPath(n,["content"]);null!=o&&setValueByPath(a,["content"],contentFromMldev(0,o));const r=getValueByPath(n,["citationMetadata"]);null!=r&&setValueByPath(a,["citationMetadata"],function citationMetadataFromMldev(t,n){const a={},o=getValueByPath(n,["citationSources"]);return null!=o&&setValueByPath(a,["citations"],o),a}(0,r));const s=getValueByPath(n,["tokenCount"]);null!=s&&setValueByPath(a,["tokenCount"],s);const i=getValueByPath(n,["finishReason"]);null!=i&&setValueByPath(a,["finishReason"],i);const l=getValueByPath(n,["avgLogprobs"]);null!=l&&setValueByPath(a,["avgLogprobs"],l);const u=getValueByPath(n,["groundingMetadata"]);null!=u&&setValueByPath(a,["groundingMetadata"],u);const c=getValueByPath(n,["index"]);null!=c&&setValueByPath(a,["index"],c);const h=getValueByPath(n,["logprobsResult"]);null!=h&&setValueByPath(a,["logprobsResult"],h);const d=getValueByPath(n,["safetyRatings"]);return null!=d&&setValueByPath(a,["safetyRatings"],d),a}function generateContentResponseFromMldev(t,n){const a={},o=getValueByPath(n,["candidates"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["candidates"],o.map((t=>candidateFromMldev(0,t)))):setValueByPath(a,["candidates"],o));const r=getValueByPath(n,["modelVersion"]);null!=r&&setValueByPath(a,["modelVersion"],r);const s=getValueByPath(n,["promptFeedback"]);null!=s&&setValueByPath(a,["promptFeedback"],s);const i=getValueByPath(n,["usageMetadata"]);return null!=i&&setValueByPath(a,["usageMetadata"],i),a}function embedContentResponseFromMldev(t,n){const a={},o=getValueByPath(n,["embeddings"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["embeddings"],o.map((t=>function contentEmbeddingFromMldev(t,n){const a={},o=getValueByPath(n,["values"]);return null!=o&&setValueByPath(a,["values"],o),a}(0,t)))):setValueByPath(a,["embeddings"],o));return null!=getValueByPath(n,["metadata"])&&setValueByPath(a,["metadata"],{}),a}function safetyAttributesFromMldev(t,n){const a={},o=getValueByPath(n,["safetyAttributes","categories"]);null!=o&&setValueByPath(a,["categories"],o);const r=getValueByPath(n,["safetyAttributes","scores"]);null!=r&&setValueByPath(a,["scores"],r);const s=getValueByPath(n,["contentType"]);return null!=s&&setValueByPath(a,["contentType"],s),a}function generatedImageFromMldev(t,n){const a={},o=getValueByPath(n,["_self"]);null!=o&&setValueByPath(a,["image"],function imageFromMldev(t,n){const a={},o=getValueByPath(n,["bytesBase64Encoded"]);null!=o&&setValueByPath(a,["imageBytes"],tBytes(0,o));const r=getValueByPath(n,["mimeType"]);return null!=r&&setValueByPath(a,["mimeType"],r),a}(0,o));const r=getValueByPath(n,["raiFilteredReason"]);null!=r&&setValueByPath(a,["raiFilteredReason"],r);const s=getValueByPath(n,["_self"]);return null!=s&&setValueByPath(a,["safetyAttributes"],safetyAttributesFromMldev(0,s)),a}function contentFromVertex(t,n){const a={},o=getValueByPath(n,["parts"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["parts"],o.map((t=>function partFromVertex(t,n){const a={},o=getValueByPath(n,["videoMetadata"]);null!=o&&setValueByPath(a,["videoMetadata"],o);const r=getValueByPath(n,["thought"]);null!=r&&setValueByPath(a,["thought"],r);const s=getValueByPath(n,["codeExecutionResult"]);null!=s&&setValueByPath(a,["codeExecutionResult"],s);const i=getValueByPath(n,["executableCode"]);null!=i&&setValueByPath(a,["executableCode"],i);const l=getValueByPath(n,["fileData"]);null!=l&&setValueByPath(a,["fileData"],l);const u=getValueByPath(n,["functionCall"]);null!=u&&setValueByPath(a,["functionCall"],u);const c=getValueByPath(n,["functionResponse"]);null!=c&&setValueByPath(a,["functionResponse"],c);const h=getValueByPath(n,["inlineData"]);null!=h&&setValueByPath(a,["inlineData"],h);const d=getValueByPath(n,["text"]);return null!=d&&setValueByPath(a,["text"],d),a}(0,t)))):setValueByPath(a,["parts"],o));const r=getValueByPath(n,["role"]);return null!=r&&setValueByPath(a,["role"],r),a}function candidateFromVertex(t,n){const a={},o=getValueByPath(n,["content"]);null!=o&&setValueByPath(a,["content"],contentFromVertex(0,o));const r=getValueByPath(n,["citationMetadata"]);null!=r&&setValueByPath(a,["citationMetadata"],function citationMetadataFromVertex(t,n){const a={},o=getValueByPath(n,["citations"]);return null!=o&&setValueByPath(a,["citations"],o),a}(0,r));const s=getValueByPath(n,["finishMessage"]);null!=s&&setValueByPath(a,["finishMessage"],s);const i=getValueByPath(n,["finishReason"]);null!=i&&setValueByPath(a,["finishReason"],i);const l=getValueByPath(n,["avgLogprobs"]);null!=l&&setValueByPath(a,["avgLogprobs"],l);const u=getValueByPath(n,["groundingMetadata"]);null!=u&&setValueByPath(a,["groundingMetadata"],u);const c=getValueByPath(n,["index"]);null!=c&&setValueByPath(a,["index"],c);const h=getValueByPath(n,["logprobsResult"]);null!=h&&setValueByPath(a,["logprobsResult"],h);const d=getValueByPath(n,["safetyRatings"]);return null!=d&&setValueByPath(a,["safetyRatings"],d),a}function generateContentResponseFromVertex(t,n){const a={},o=getValueByPath(n,["candidates"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["candidates"],o.map((t=>candidateFromVertex(0,t)))):setValueByPath(a,["candidates"],o));const r=getValueByPath(n,["createTime"]);null!=r&&setValueByPath(a,["createTime"],r);const s=getValueByPath(n,["responseId"]);null!=s&&setValueByPath(a,["responseId"],s);const i=getValueByPath(n,["modelVersion"]);null!=i&&setValueByPath(a,["modelVersion"],i);const l=getValueByPath(n,["promptFeedback"]);null!=l&&setValueByPath(a,["promptFeedback"],l);const u=getValueByPath(n,["usageMetadata"]);return null!=u&&setValueByPath(a,["usageMetadata"],u),a}function contentEmbeddingFromVertex(t,n){const a={},o=getValueByPath(n,["values"]);null!=o&&setValueByPath(a,["values"],o);const r=getValueByPath(n,["statistics"]);return null!=r&&setValueByPath(a,["statistics"],function contentEmbeddingStatisticsFromVertex(t,n){const a={},o=getValueByPath(n,["truncated"]);null!=o&&setValueByPath(a,["truncated"],o);const r=getValueByPath(n,["token_count"]);return null!=r&&setValueByPath(a,["tokenCount"],r),a}(0,r)),a}function embedContentResponseFromVertex(t,n){const a={},o=getValueByPath(n,["predictions[]","embeddings"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["embeddings"],o.map((t=>contentEmbeddingFromVertex(0,t)))):setValueByPath(a,["embeddings"],o));const r=getValueByPath(n,["metadata"]);return null!=r&&setValueByPath(a,["metadata"],function embedContentMetadataFromVertex(t,n){const a={},o=getValueByPath(n,["billableCharacterCount"]);return null!=o&&setValueByPath(a,["billableCharacterCount"],o),a}(0,r)),a}function safetyAttributesFromVertex(t,n){const a={},o=getValueByPath(n,["safetyAttributes","categories"]);null!=o&&setValueByPath(a,["categories"],o);const r=getValueByPath(n,["safetyAttributes","scores"]);null!=r&&setValueByPath(a,["scores"],r);const s=getValueByPath(n,["contentType"]);return null!=s&&setValueByPath(a,["contentType"],s),a}function generatedImageFromVertex(t,n){const a={},o=getValueByPath(n,["_self"]);null!=o&&setValueByPath(a,["image"],function imageFromVertex(t,n){const a={},o=getValueByPath(n,["gcsUri"]);null!=o&&setValueByPath(a,["gcsUri"],o);const r=getValueByPath(n,["bytesBase64Encoded"]);null!=r&&setValueByPath(a,["imageBytes"],tBytes(0,r));const s=getValueByPath(n,["mimeType"]);return null!=s&&setValueByPath(a,["mimeType"],s),a}(0,o));const r=getValueByPath(n,["raiFilteredReason"]);null!=r&&setValueByPath(a,["raiFilteredReason"],r);const s=getValueByPath(n,["_self"]);null!=s&&setValueByPath(a,["safetyAttributes"],safetyAttributesFromVertex(0,s));const i=getValueByPath(n,["prompt"]);return null!=i&&setValueByPath(a,["enhancedPrompt"],i),a}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */
	function liveConnectParametersToMldev(t,n){const a={},o=getValueByPath(n,["config"]);null!=o&&setValueByPath(a,["setup"],function liveConnectConfigToMldev(t,n){const a={},o=getValueByPath(n,["generationConfig"]);void 0!==o&&setValueByPath(a,["generationConfig"],o);const r=getValueByPath(n,["responseModalities"]);void 0!==r&&setValueByPath(a,["generationConfig","responseModalities"],r);const s=getValueByPath(n,["speechConfig"]);void 0!==s&&setValueByPath(a,["generationConfig","speechConfig"],s);const i=getValueByPath(n,["systemInstruction"]);null!=i&&setValueByPath(a,["systemInstruction"],contentToMldev(0,i));const l=getValueByPath(n,["tools"]);null!=l&&Array.isArray(l)&&setValueByPath(a,["tools"],l.map((t=>toolToMldev(0,t))));return a}(0,o));const r=getValueByPath(n,["model"]);return void 0!==r&&setValueByPath(a,["setup","model"],r),a}function liveConnectParametersToVertex(t,n){const a={},o=getValueByPath(n,["config"]);null!=o&&setValueByPath(a,["setup"],function liveConnectConfigToVertex(t,n){const a={},o=getValueByPath(n,["generationConfig"]);void 0!==o&&setValueByPath(a,["generationConfig"],o);const r=getValueByPath(n,["responseModalities"]);setValueByPath(a,["generationConfig","responseModalities"],void 0!==r?r:["AUDIO"]);const s=getValueByPath(n,["speechConfig"]);void 0!==s&&setValueByPath(a,["generationConfig","speechConfig"],s);const i=getValueByPath(n,["systemInstruction"]);null!=i&&setValueByPath(a,["systemInstruction"],contentToVertex(0,i));const l=getValueByPath(n,["tools"]);null!=l&&Array.isArray(l)&&setValueByPath(a,["tools"],l.map((t=>toolToVertex(0,t))));return a}(0,o));const r=getValueByPath(n,["model"]);return void 0!==r&&setValueByPath(a,["setup","model"],r),a}function liveServerMessageFromMldev(t,n){const a={},o=getValueByPath(n,["setupComplete"]);void 0!==o&&setValueByPath(a,["setupComplete"],o);const r=getValueByPath(n,["serverContent"]);null!=r&&setValueByPath(a,["serverContent"],function liveServerContentFromMldev(t,n){const a={},o=getValueByPath(n,["modelTurn"]);null!=o&&setValueByPath(a,["modelTurn"],contentFromMldev(0,o));const r=getValueByPath(n,["turnComplete"]);void 0!==r&&setValueByPath(a,["turnComplete"],r);const s=getValueByPath(n,["interrupted"]);void 0!==s&&setValueByPath(a,["interrupted"],s);return a}(0,r));const s=getValueByPath(n,["toolCall"]);null!=s&&setValueByPath(a,["toolCall"],function liveServerToolCallFromMldev(t,n){const a={},o=getValueByPath(n,["functionCalls"]);null!=o&&Array.isArray(o)&&setValueByPath(a,["functionCalls"],o.map((t=>function functionCallFromMldev(t,n){const a={},o=getValueByPath(n,["id"]);void 0!==o&&setValueByPath(a,["id"],o);const r=getValueByPath(n,["args"]);void 0!==r&&setValueByPath(a,["args"],r);const s=getValueByPath(n,["name"]);void 0!==s&&setValueByPath(a,["name"],s);return a}(0,t))));return a}(0,s));const i=getValueByPath(n,["toolCallCancellation"]);return null!=i&&setValueByPath(a,["toolCallCancellation"],function liveServerToolCallCancellationFromMldev(t,n){const a={},o=getValueByPath(n,["ids"]);void 0!==o&&setValueByPath(a,["ids"],o);return a}(0,i)),a}function liveServerMessageFromVertex(t,n){const a={},o=getValueByPath(n,["setupComplete"]);void 0!==o&&setValueByPath(a,["setupComplete"],o);const r=getValueByPath(n,["serverContent"]);null!=r&&setValueByPath(a,["serverContent"],function liveServerContentFromVertex(t,n){const a={},o=getValueByPath(n,["modelTurn"]);null!=o&&setValueByPath(a,["modelTurn"],contentFromVertex(0,o));const r=getValueByPath(n,["turnComplete"]);void 0!==r&&setValueByPath(a,["turnComplete"],r);const s=getValueByPath(n,["interrupted"]);void 0!==s&&setValueByPath(a,["interrupted"],s);return a}(0,r));const s=getValueByPath(n,["toolCall"]);null!=s&&setValueByPath(a,["toolCall"],function liveServerToolCallFromVertex(t,n){const a={},o=getValueByPath(n,["functionCalls"]);null!=o&&Array.isArray(o)&&setValueByPath(a,["functionCalls"],o.map((t=>function functionCallFromVertex(t,n){const a={},o=getValueByPath(n,["args"]);void 0!==o&&setValueByPath(a,["args"],o);const r=getValueByPath(n,["name"]);void 0!==r&&setValueByPath(a,["name"],r);return a}(0,t))));return a}(0,s));const i=getValueByPath(n,["toolCallCancellation"]);return null!=i&&setValueByPath(a,["toolCallCancellation"],function liveServerToolCallCancellationFromVertex(t,n){const a={},o=getValueByPath(n,["ids"]);void 0!==o&&setValueByPath(a,["ids"],o);return a}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */(0,i)),a}class Live{constructor(t,n,a){this.apiClient=t,this.auth=n,this.webSocketFactory=a;}async connect(t){var n,a;const o=this.apiClient.getWebsocketBaseUrl(),r=this.apiClient.getApiVersion();let s;const i=function mapToHeaders(t){const n=new Headers;for(const[a,o]of Object.entries(t))n.append(a,o);return n}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */(this.apiClient.getDefaultHeaders());if(this.apiClient.isVertexAI())s=`${o}/ws/google.cloud.aiplatform.${r}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(i);else {s=`${o}/ws/google.ai.generativelanguage.${r}.GenerativeService.BidiGenerateContent?key=${this.apiClient.getApiKey()}`;}let onopenResolve=()=>{};const l=new Promise((t=>{onopenResolve=t;})),u=t.callbacks,c=this.apiClient,h={onopen:function(){var t;null===(t=null==u?void 0:u.onopen)||void 0===t||t.call(u),onopenResolve({});},onmessage:t=>{!async function handleWebSocketMessage(t,n,a){let o,r;r=a.data instanceof Blob?JSON.parse(await a.data.text()):JSON.parse(a.data),o=t.isVertexAI()?liveServerMessageFromVertex(0,r):liveServerMessageFromMldev(0,r),n(o);}(c,u.onmessage,t);},onerror:null!==(n=null==u?void 0:u.onerror)&&void 0!==n?n:function(t){},onclose:null!==(a=null==u?void 0:u.onclose)&&void 0!==a?a:function(t){}},d=this.webSocketFactory.create(s,function headersToMap(t){const n={};return t.forEach(((t,a)=>{n[a]=t;})),n}(i),h);d.connect(),await l;let p=tModel(this.apiClient,t.model);if(this.apiClient.isVertexAI()&&p.startsWith("publishers/")){p=`projects/${this.apiClient.getProject()}/locations/${this.apiClient.getLocation()}/`+p;}let g={};const P={model:p,config:t.config,callbacks:t.callbacks};return g=this.apiClient.isVertexAI()?liveConnectParametersToVertex(this.apiClient,P):liveConnectParametersToMldev(this.apiClient,P),d.send(JSON.stringify(g)),new Session(d,this.apiClient)}}const Me={turnComplete:true};class Session{constructor(t,n){this.conn=t,this.apiClient=n;}tLiveClientContent(t,n){if(null!==n.turns&&void 0!==n.turns){let o=[];try{o=tContents(0,n.turns),o=t.isVertexAI()?o.map((t=>contentToVertex(0,t))):o.map((t=>contentToMldev(0,t)));}catch(a){throw new Error(`Failed to parse client content "turns", type: '${typeof n.turns}'`)}return {clientContent:{turns:o,turnComplete:n.turnComplete}}}return {clientContent:{turnComplete:n.turnComplete}}}tLiveClientRealtimeInput(t,n){let a={};if(!("media"in n)||!n.media)throw new Error(`Failed to convert realtime input "media", type: '${typeof n.media}'`);return a={realtimeInput:{mediaChunks:[n.media]}},a}tLiveClienttToolResponse(t,n){let a=[];if(null==n.functionResponses)throw new Error("functionResponses is required.");if(Array.isArray(n.functionResponses)||(a=[n.functionResponses]),0===a.length)throw new Error("functionResponses is required.");for(const o of a){if("object"!=typeof o||null===o||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!t.isVertexAI()&&!("id"in o))throw new Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return {toolResponse:{functionResponses:a}}}sendClientContent(t){t=Object.assign(Object.assign({},Me),t);const n=this.tLiveClientContent(this.apiClient,t);this.conn.send(JSON.stringify(n));}sendRealtimeInput(t){if(null==t.media)throw new Error("Media is required.");const n=this.tLiveClientRealtimeInput(this.apiClient,t);this.conn.send(JSON.stringify(n));}sendToolResponse(t){if(null==t.functionResponses)throw new Error("Tool response parameters are required.");const n=this.tLiveClienttToolResponse(this.apiClient,t);this.conn.send(JSON.stringify(n));}close(){this.conn.close();}}class Models extends BaseModule{constructor(t){super(),this.apiClient=t,this.generateContent=async t=>await this.generateContentInternal(t),this.generateContentStream=async t=>await this.generateContentStreamInternal(t),this.generateImages=async t=>await this.generateImagesInternal(t).then((t=>{var n;let a;const o=[];if(null==t?void 0:t.generatedImages)for(const s of t.generatedImages)s&&(null==s?void 0:s.safetyAttributes)&&"Positive Prompt"===(null===(n=null==s?void 0:s.safetyAttributes)||void 0===n?void 0:n.contentType)?a=null==s?void 0:s.safetyAttributes:o.push(s);let r;return r=a?{generatedImages:o,positivePromptSafetyAttributes:a}:{generatedImages:o},r}));}async generateContentInternal(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=generateContentParametersToVertex(this.apiClient,t);return r=formatMap("{model}:generateContent",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>{const n=generateContentResponseFromVertex(this.apiClient,t),a=new GenerateContentResponse;return Object.assign(a,n),a}))}{const n=generateContentParametersToMldev(this.apiClient,t);return r=formatMap("{model}:generateContent",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>{const n=generateContentResponseFromMldev(this.apiClient,t),a=new GenerateContentResponse;return Object.assign(a,n),a}))}}async generateContentStreamInternal(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=generateContentParametersToVertex(this.apiClient,t);r=formatMap("{model}:streamGenerateContent?alt=sse",a._url),s=a._query,delete a.config,delete a._url,delete a._query;const i=this.apiClient;return o=i.requestStream({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}),o.then((function(t){return __asyncGenerator(this,arguments,(function*(){var n,a,o,r;try{for(var s,i=!0,l=__asyncValues(t);!(n=(s=yield __await(l.next())).done);i=!0){r=s.value,i=!1;const t=generateContentResponseFromVertex(0,r),n=new GenerateContentResponse;Object.assign(n,t),yield yield __await(n);}}catch(u){a={error:u};}finally{try{i||n||!(o=l.return)||(yield __await(o.call(l)));}finally{if(a)throw a.error}}}))}))}{const n=generateContentParametersToMldev(this.apiClient,t);r=formatMap("{model}:streamGenerateContent?alt=sse",n._url),s=n._query,delete n.config,delete n._url,delete n._query;const i=this.apiClient;return o=i.requestStream({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}),o.then((function(t){return __asyncGenerator(this,arguments,(function*(){var n,a,o,r;try{for(var s,i=!0,l=__asyncValues(t);!(n=(s=yield __await(l.next())).done);i=!0){r=s.value,i=!1;const t=generateContentResponseFromMldev(0,r),n=new GenerateContentResponse;Object.assign(n,t),yield yield __await(n);}}catch(u){a={error:u};}finally{try{i||n||!(o=l.return)||(yield __await(o.call(l)));}finally{if(a)throw a.error}}}))}))}}async embedContent(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=embedContentParametersToVertex(this.apiClient,t);return r=formatMap("{model}:predict",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>{const n=embedContentResponseFromVertex(this.apiClient,t),a=new EmbedContentResponse;return Object.assign(a,n),a}))}{const n=embedContentParametersToMldev(this.apiClient,t);return r=formatMap("{model}:batchEmbedContents",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>{const n=embedContentResponseFromMldev(this.apiClient,t),a=new EmbedContentResponse;return Object.assign(a,n),a}))}}async generateImagesInternal(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=generateImagesParametersToVertex(this.apiClient,t);return r=formatMap("{model}:predict",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>{const n=function generateImagesResponseFromVertex(t,n){const a={},o=getValueByPath(n,["predictions"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["generatedImages"],o.map((t=>generatedImageFromVertex(0,t)))):setValueByPath(a,["generatedImages"],o));const r=getValueByPath(n,["positivePromptSafetyAttributes"]);return null!=r&&setValueByPath(a,["positivePromptSafetyAttributes"],safetyAttributesFromVertex(0,r)),a}(this.apiClient,t),a=new GenerateImagesResponse;return Object.assign(a,n),a}))}{const n=generateImagesParametersToMldev(this.apiClient,t);return r=formatMap("{model}:predict",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>{const n=function generateImagesResponseFromMldev(t,n){const a={},o=getValueByPath(n,["predictions"]);null!=o&&(Array.isArray(o)?setValueByPath(a,["generatedImages"],o.map((t=>generatedImageFromMldev(0,t)))):setValueByPath(a,["generatedImages"],o));const r=getValueByPath(n,["positivePromptSafetyAttributes"]);return null!=r&&setValueByPath(a,["positivePromptSafetyAttributes"],safetyAttributesFromMldev(0,r)),a}(this.apiClient,t),a=new GenerateImagesResponse;return Object.assign(a,n),a}))}}async countTokens(t){var n,a;let o,r="",s={};if(this.apiClient.isVertexAI()){const a=countTokensParametersToVertex(this.apiClient,t);return r=formatMap("{model}:countTokens",a._url),s=a._query,delete a.config,delete a._url,delete a._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(a),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),o.then((t=>{const n=function countTokensResponseFromVertex(t,n){const a={},o=getValueByPath(n,["totalTokens"]);return null!=o&&setValueByPath(a,["totalTokens"],o),a}(this.apiClient,t),a=new CountTokensResponse;return Object.assign(a,n),a}))}{const n=countTokensParametersToMldev(this.apiClient,t);return r=formatMap("{model}:countTokens",n._url),s=n._query,delete n.config,delete n._url,delete n._query,o=this.apiClient.request({path:r,queryParams:s,body:JSON.stringify(n),httpMethod:"POST",httpOptions:null===(a=t.config)||void 0===a?void 0:a.httpOptions}).then((t=>t.json())),o.then((t=>{const n=function countTokensResponseFromMldev(t,n){const a={},o=getValueByPath(n,["totalTokens"]);null!=o&&setValueByPath(a,["totalTokens"],o);const r=getValueByPath(n,["cachedContentTokenCount"]);return null!=r&&setValueByPath(a,["cachedContentTokenCount"],r),a}(this.apiClient,t),a=new CountTokensResponse;return Object.assign(a,n),a}))}}async computeTokens(t){var n;let a,o="",r={};if(this.apiClient.isVertexAI()){const s=function computeTokensParametersToVertex(t,n){const a={},o=getValueByPath(n,["model"]);null!=o&&setValueByPath(a,["_url","model"],tModel(t,o));const r=getValueByPath(n,["contents"]);null!=r&&(Array.isArray(r)?setValueByPath(a,["contents"],tContents(0,tContents(0,r).map((t=>contentToVertex(0,t))))):setValueByPath(a,["contents"],tContents(0,r)));const s=getValueByPath(n,["config"]);return null!=s&&setValueByPath(a,["config"],s),a}(this.apiClient,t);return o=formatMap("{model}:computeTokens",s._url),r=s._query,delete s.config,delete s._url,delete s._query,a=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),a.then((t=>{const n=function computeTokensResponseFromVertex(t,n){const a={},o=getValueByPath(n,["tokensInfo"]);return null!=o&&setValueByPath(a,["tokensInfo"],o),a}(this.apiClient,t),a=new ComputeTokensResponse;return Object.assign(a,n),a}))}throw new Error("This method is only supported by the Vertex AI.")}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */const Le=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class ClientError extends Error{constructor(t,n){super(t,n?{cause:n}:{cause:(new Error).stack}),this.message=t,this.name="ClientError";}}class ServerError extends Error{constructor(t,n){super(t,n?{cause:n}:{cause:(new Error).stack}),this.message=t,this.name="ServerError";}}class ApiClient{constructor(t){var n,a;this.clientOptions=Object.assign(Object.assign({},t),{project:t.project,location:t.location,apiKey:t.apiKey,vertexai:t.vertexai});const o={};this.clientOptions.vertexai?(o.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta1",this.getProject()||this.getLocation()?(o.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`,this.clientOptions.apiKey=void 0):(o.baseUrl="https://aiplatform.googleapis.com/",this.clientOptions.project=void 0,this.clientOptions.location=void 0)):(o.apiVersion=null!==(a=this.clientOptions.apiVersion)&&void 0!==a?a:"v1beta",o.baseUrl="https://generativelanguage.googleapis.com/"),o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,t.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,t.httpOptions));}isVertexAI(){var t;return null!==(t=this.clientOptions.vertexai)&&void 0!==t&&t}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(t){if(!t||void 0===t.baseUrl||void 0===t.apiVersion)throw new Error("HTTP options are not correctly set.");const n=[t.baseUrl.endsWith("/")?t.baseUrl.slice(0,-1):t.baseUrl];return t.apiVersion&&""!==t.apiVersion&&n.push(t.apiVersion),n.join("/")}getBaseResourcePath(){return `projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const t=this.getBaseUrl(),n=new URL(t);return n.protocol="wss",n.toString()}setBaseUrl(t){if(!this.clientOptions.httpOptions)throw new Error("HTTP options are not correctly set.");this.clientOptions.httpOptions.baseUrl=t;}constructUrl(t,n){const a=[this.getRequestUrlInternal(n)];!this.clientOptions.vertexai||this.clientOptions.apiKey||t.startsWith("projects/")||a.push(this.getBaseResourcePath()),""!==t&&a.push(t);return new URL(`${a.join("/")}`)}async request(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const a=this.constructUrl(t.path,n);if(t.queryParams)for(const[r,s]of Object.entries(t.queryParams))a.searchParams.append(r,String(s));let o={};if("GET"===t.httpMethod){if(t.body&&"{}"!==t.body)throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=t.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,n),this.unaryApiCall(a,o,t.httpMethod)}patchHttpOptions(t,n){const a=JSON.parse(JSON.stringify(t));for(const[o,r]of Object.entries(n))"object"==typeof r?a[o]=Object.assign(Object.assign({},a[o]),r):void 0!==r&&(a[o]=r);return a}async requestStream(t){let n=this.clientOptions.httpOptions;t.httpOptions&&(n=this.patchHttpOptions(this.clientOptions.httpOptions,t.httpOptions));const a=this.constructUrl(t.path,n);a.searchParams.has("alt")&&"sse"===a.searchParams.get("alt")||a.searchParams.set("alt","sse");let o={};return o.body=t.body,o=await this.includeExtraHttpOptionsToRequestInit(o,n),this.streamApiCall(a,o,t.httpMethod)}async includeExtraHttpOptionsToRequestInit(t,n){if(n&&n.timeout&&n.timeout>0){const a=new AbortController,o=a.signal;setTimeout((()=>a.abort()),n.timeout),t.signal=o;}return t.headers=await this.getHeadersInternal(n),t}async unaryApiCall(t,n,a){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:a})).then((async t=>(await throwErrorIfNotOK(t),new HttpResponse(t)))).catch((t=>{throw t instanceof Error?t:new Error(JSON.stringify(t))}))}async streamApiCall(t,n,a){return this.apiCall(t.toString(),Object.assign(Object.assign({},n),{method:a})).then((async t=>(await throwErrorIfNotOK(t),this.processStreamResponse(t)))).catch((t=>{throw t instanceof Error?t:new Error(JSON.stringify(t))}))}processStreamResponse(t){var n;return __asyncGenerator(this,arguments,(function*processStreamResponse_1(){const a=null===(n=null==t?void 0:t.body)||void 0===n?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!a)throw new Error("Response body is empty");try{let t="";for(;;){const{done:n,value:r}=yield __await(a.read());if(n){if(t.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}t+=o.decode(r);let s=t.match(Le);for(;s;){const n=s[1];try{const a=JSON.parse(n);yield yield __await(a),t=t.slice(s[0].length),s=t.match(Le);}catch(e){throw new Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{a.releaseLock();}}))}async apiCall(t,n){return fetch(t,n).catch((t=>{throw new Error(`exception ${t} sending request`)}))}getDefaultHeaders(){const t={},n="google-genai-sdk/0.6.1 "+this.clientOptions.userAgentExtra;return t["User-Agent"]=n,t["x-goog-api-client"]=n,t["Content-Type"]="application/json",t}async getHeadersInternal(t){const n=new Headers;if(t&&t.headers)for(const[a,o]of Object.entries(t.headers))n.append(a,o);return await this.clientOptions.auth.addAuthHeaders(n),n}async uploadFile(t,n){var a;const o={};null!=n&&(o.mimeType=n.mimeType,o.name=n.name,o.displayName=n.displayName),o.name&&!o.name.startsWith("files/")&&(o.name=`files/${o.name}`);const r=this.clientOptions.uploader,s=await r.stat(t);o.sizeBytes=s.size;const i=null!==(a=null==n?void 0:n.mimeType)&&void 0!==a?a:s.type;if(void 0===i||""===i)throw new Error("Can not determine mimeType. Please provide mimeType in the config.");o.mimeType=i;const l=await this.fetchUploadUrl(o,n);return r.upload(t,l,this)}async fetchUploadUrl(t,n){var a;let o={};o=(null==n?void 0:n.httpOptions)?n.httpOptions:{apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${t.mimeType}`}};const r={file:t},s=await this.request({path:formatMap("upload/v1beta/files",r._url),body:JSON.stringify(r),httpMethod:"POST",httpOptions:o});if(!s||!(null==s?void 0:s.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const i=null===(a=null==s?void 0:s.headers)||void 0===a?void 0:a["x-goog-upload-url"];if(void 0===i)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return i}}async function throwErrorIfNotOK(t){var n;if(void 0===t)throw new ServerError("response is undefined");if(!t.ok){const a=t.status,o=t.statusText;let r;r=(null===(n=t.headers.get("content-type"))||void 0===n?void 0:n.includes("application/json"))?await t.json():{error:{message:"exception parsing response",code:t.status,status:t.statusText}};const s=`got status: ${a} ${o}. ${JSON.stringify(r)}`;if(a>=400&&a<500){throw new ClientError(s)}if(a>=500&&a<600){throw new ServerError(s)}throw new Error(s)}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */function listFilesParametersToMldev(t,n){const a={},o=getValueByPath(n,["config"]);return null!=o&&setValueByPath(a,["config"],function listFilesConfigToMldev(t,n,a){const o=getValueByPath(n,["pageSize"]);void 0!==a&&null!=o&&setValueByPath(a,["_query","pageSize"],o);const r=getValueByPath(n,["pageToken"]);return void 0!==a&&null!=r&&setValueByPath(a,["_query","pageToken"],r),{}}(0,o,a)),a}function fileToMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["name"],o);const r=getValueByPath(n,["displayName"]);null!=r&&setValueByPath(a,["displayName"],r);const s=getValueByPath(n,["mimeType"]);null!=s&&setValueByPath(a,["mimeType"],s);const i=getValueByPath(n,["sizeBytes"]);null!=i&&setValueByPath(a,["sizeBytes"],i);const l=getValueByPath(n,["createTime"]);null!=l&&setValueByPath(a,["createTime"],l);const u=getValueByPath(n,["expirationTime"]);null!=u&&setValueByPath(a,["expirationTime"],u);const c=getValueByPath(n,["updateTime"]);null!=c&&setValueByPath(a,["updateTime"],c);const h=getValueByPath(n,["sha256Hash"]);null!=h&&setValueByPath(a,["sha256Hash"],h);const d=getValueByPath(n,["uri"]);null!=d&&setValueByPath(a,["uri"],d);const p=getValueByPath(n,["downloadUri"]);null!=p&&setValueByPath(a,["downloadUri"],p);const g=getValueByPath(n,["state"]);null!=g&&setValueByPath(a,["state"],g);const P=getValueByPath(n,["source"]);null!=P&&setValueByPath(a,["source"],P);const V=getValueByPath(n,["videoMetadata"]);null!=V&&setValueByPath(a,["videoMetadata"],V);const B=getValueByPath(n,["error"]);return null!=B&&setValueByPath(a,["error"],function fileStatusToMldev(t,n){const a={},o=getValueByPath(n,["details"]);null!=o&&setValueByPath(a,["details"],o);const r=getValueByPath(n,["message"]);null!=r&&setValueByPath(a,["message"],r);const s=getValueByPath(n,["code"]);return null!=s&&setValueByPath(a,["code"],s),a}(0,B)),a}function fileFromMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["name"],o);const r=getValueByPath(n,["displayName"]);null!=r&&setValueByPath(a,["displayName"],r);const s=getValueByPath(n,["mimeType"]);null!=s&&setValueByPath(a,["mimeType"],s);const i=getValueByPath(n,["sizeBytes"]);null!=i&&setValueByPath(a,["sizeBytes"],i);const l=getValueByPath(n,["createTime"]);null!=l&&setValueByPath(a,["createTime"],l);const u=getValueByPath(n,["expirationTime"]);null!=u&&setValueByPath(a,["expirationTime"],u);const c=getValueByPath(n,["updateTime"]);null!=c&&setValueByPath(a,["updateTime"],c);const h=getValueByPath(n,["sha256Hash"]);null!=h&&setValueByPath(a,["sha256Hash"],h);const d=getValueByPath(n,["uri"]);null!=d&&setValueByPath(a,["uri"],d);const p=getValueByPath(n,["downloadUri"]);null!=p&&setValueByPath(a,["downloadUri"],p);const g=getValueByPath(n,["state"]);null!=g&&setValueByPath(a,["state"],g);const P=getValueByPath(n,["source"]);null!=P&&setValueByPath(a,["source"],P);const V=getValueByPath(n,["videoMetadata"]);null!=V&&setValueByPath(a,["videoMetadata"],V);const B=getValueByPath(n,["error"]);return null!=B&&setValueByPath(a,["error"],function fileStatusFromMldev(t,n){const a={},o=getValueByPath(n,["details"]);null!=o&&setValueByPath(a,["details"],o);const r=getValueByPath(n,["message"]);null!=r&&setValueByPath(a,["message"],r);const s=getValueByPath(n,["code"]);return null!=s&&setValueByPath(a,["code"],s),a}(0,B)),a}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */
	class Files extends BaseModule{constructor(t){super(),this.apiClient=t,this.list=async(t={})=>new Pager(ce.PAGED_ITEM_FILES,(t=>this.listInternal(t)),await this.listInternal(t),t);}async upload(t){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(t.file,t.config).then((t=>fileFromMldev(this.apiClient,t)))}async listInternal(t){var n;let a,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=listFilesParametersToMldev(this.apiClient,t);return o=formatMap("files",s._url),r=s._query,delete s.config,delete s._url,delete s._query,a=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),a.then((t=>{const n=function listFilesResponseFromMldev(t,n){const a={},o=getValueByPath(n,["nextPageToken"]);null!=o&&setValueByPath(a,["nextPageToken"],o);const r=getValueByPath(n,["files"]);return null!=r&&(Array.isArray(r)?setValueByPath(a,["files"],r.map((t=>fileFromMldev(0,t)))):setValueByPath(a,["files"],r)),a}(this.apiClient,t),a=new ListFilesResponse;return Object.assign(a,n),a}))}}async createInternal(t){var n;let a,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function createFileParametersToMldev(t,n){const a={},o=getValueByPath(n,["file"]);null!=o&&setValueByPath(a,["file"],fileToMldev(0,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return o=formatMap("upload/v1beta/files",s._url),r=s._query,delete s.config,delete s._url,delete s._query,a=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),a.then((t=>{const n=function createFileResponseFromMldev(t,n){const a={},o=getValueByPath(n,["httpHeaders"]);return null!=o&&setValueByPath(a,["httpHeaders"],o),a}(this.apiClient,t),a=new CreateFileResponse;return Object.assign(a,n),a}))}}async get(t){var n;let a,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function getFileParametersToMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","file"],tFileName(0,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return o=formatMap("files/{file}",s._url),r=s._query,delete s.config,delete s._url,delete s._query,a=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(s),httpMethod:"GET",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),a.then((t=>fileFromMldev(this.apiClient,t)))}}async delete(t){var n;let a,o="",r={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const s=function deleteFileParametersToMldev(t,n){const a={},o=getValueByPath(n,["name"]);null!=o&&setValueByPath(a,["_url","file"],tFileName(0,o));const r=getValueByPath(n,["config"]);return null!=r&&setValueByPath(a,["config"],r),a}(this.apiClient,t);return o=formatMap("files/{file}",s._url),r=s._query,delete s.config,delete s._url,delete s._query,a=this.apiClient.request({path:o,queryParams:r,body:JSON.stringify(s),httpMethod:"DELETE",httpOptions:null===(n=t.config)||void 0===n?void 0:n.httpOptions}).then((t=>t.json())),a.then((()=>{const t={},n=new DeleteFileResponse;return Object.assign(n,t),n}))}}}class BrowserUploader{async upload(t,n,a){if("string"==typeof t)throw new Error("File path is not supported in browser uploader.");return await async function uploadBlob(t,n,a){var o,r;let s=0,i=0,l=new HttpResponse(new Response),u="upload";for(s=t.size;i<s;){const r=Math.min(8388608,s-i),c=t.slice(i,i+r);if(i+r>=s&&(u+=", finalize"),l=await a.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:n,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(i),"Content-Length":String(r)}}}),i+=r,"active"!==(null===(o=null==l?void 0:l.headers)||void 0===o?void 0:o["x-goog-upload-status"]))break;if(s<=i)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const c=await(null==l?void 0:l.json());if("final"!==(null===(r=null==l?void 0:l.headers)||void 0===r?void 0:r["x-goog-upload-status"]))throw new Error("Failed to upload file: Upload status is not finalized.");return c.file}(t,n,a)}async stat(t){if("string"==typeof t)throw new Error("File path is not supported in browser uploader.");return await async function getBlobStat(t){return {size:t.size,type:t.type}}(t)}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */class BrowserWebSocketFactory{create(t,n,a){return new BrowserWebSocket(t,n,a)}}class BrowserWebSocket{constructor(t,n,a){this.url=t,this.headers=n,this.callbacks=a;}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage;}send(t){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.send(t);}close(){if(void 0===this.ws)throw new Error("WebSocket is not connected");this.ws.close();}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */const De="x-goog-api-key";class WebAuth{constructor(t){this.apiKey=t;}async addAuthHeaders(t){null===t.get(De)&&t.append(De,this.apiKey);}}
	/**
	 * @license
	 * Copyright 2025 Google LLC
	 * SPDX-License-Identifier: Apache-2.0
	 */class GoogleGenAI{constructor(t){var n;if(null==t.apiKey)throw new Error("An API Key must be set when running in a browser");if(t.project||t.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=null!==(n=t.vertexai)&&void 0!==n&&n,this.apiKey=t.apiKey,this.apiVersion=t.apiVersion;const a=new WebAuth(this.apiKey);this.apiClient=new ApiClient({auth:a,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:t.httpOptions,userAgentExtra:"gl-node/web",uploader:new BrowserUploader}),this.models=new Models(this.apiClient),this.live=new Live(this.apiClient,a,new BrowserWebSocketFactory),this.chats=new Chats(this.models,this.apiClient),this.caches=new Caches(this.apiClient),this.files=new Files(this.apiClient);}}var ke=(()=>"undefined"!=typeof GM?GM:void 0)();async function fetchApi(t,n="json"){try{const a=await fetch(t);return "json"===n?await a.json():await a.text()}catch(a){throw new Error(`Fetch error: ${a}`)}}async function fetchAndCached(t,n=false){const{apiURL:a,apiType:o,nameOfCache:r}=t,s=await ke.getValue(`${r}-check`),i=await ke.getValue(r);if(n||!s||!i||Date.now()-s>432e5)try{let n=await fetchApi(a,o);return t.parseJSON&&(n=n?JSON.parse(n):null),n&&(await ke.setValue(r,t.parseJSON?JSON.stringify(n):n),await ke.setValue(`${r}-check`,Date.now())),n}catch(l){return console.error("Error fetching:",l),i?JSON.parse(i):null}return t.parseJSON?JSON.parse(i):i}async function getSystemPrompt(t=false){return await fetchAndCached({apiURL:"https://gist.githubusercontent.com/sourman-dev/1f8bc4876a5a300105ec657231fbfb30/raw",apiType:"text",nameOfCache:"dichtruyen:ai-systemPrompt"},t)}async function getAiProviders(t=false){return await fetchAndCached({apiURL:"https://gist.githubusercontent.com/sourman-dev/7d393f0f46987eec725da4388e278813/raw",apiType:"text",nameOfCache:"dichtruyen-ai:providers",parseJSON:true},t)}const translateFunc=async(t,n)=>{try{const a=function currentAiProvider(){const t={name:null,baseURL:null,model:null,apiKey:null},n=Ge.providers.find((t=>!0===t.selected));if(n){t.name=n.name,t.baseURL=n.baseUrl,t.apiKey=n.apiKey;const a=n.models.find((t=>!0===t.selected));a&&(t.model=a.name);}if(null!==t.apiKey&&null!==t.model)return t}();if(!t||t.length<=5)return;const o=function currentPrompt(t){const n=Ge.prompt.systemPrompts.find((t=>t.selected))?.content,a=Ge.prompt.userPrompts.find((t=>t.selected))?.content;return {isValid:null!=n&&n.length>10,content:le`${ie`${n}\n${a}`}\n<content>${t}</content>`}}(t);if(!a||!o.isValid)return;if(replaceAppState({isTranslating:!0,currentView:"reader"}),!a?.baseURL||!a?.apiKey)throw new Error("AI provider configuration is incomplete.");let r="";if("google"!==a.name){const t={baseURL:a.baseURL,apiKey:a.apiKey,data:{model:a?.model,messages:[{role:"user",content:o.content}],stream:!0}};await async function openAICompletion(t,n){try{const a=`${t.baseURL}chat/completions`,o=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t.apiKey}`},body:JSON.stringify(t.data)});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);if(o.body?.getReader){const t=o.body.getReader(),a=new TextDecoder;let r="";for(;;){const{done:o,value:s}=await t.read();if(o)break;r+=a.decode(s,{stream:!0});const i=r.split("\n");r=i.pop()||"";for(const t of i){const a=t.trim();if(a&&a.startsWith("data: "))try{const t=a.slice(5).trim();if("[DONE]"===t)return void n("\n[Translation completed]");const o=JSON.parse(t),r=o?.choices?.[0]?.delta?.content;if(r&&n(r),"stop"===o?.choices?.[0]?.finish_reason)return void n("\n[Translation completed]")}catch(e){console.warn("Error parsing chunk:",e);continue}}}}else {const t=await o.text();try{const a=t.split("\n");for(const t of a)if(t.startsWith("data: ")){const a=t.slice(5).trim();if("[DONE]"===a)continue;const o=JSON.parse(a),r=o?.choices?.[0]?.delta?.content;r&&n(r);}n("\n[Translation completed]");}catch(e){throw console.error("Error processing response:",e),e}}}catch(a){throw console.error("Stream error:",a),a}}(t,(t=>{console.log("In progress..."),r+=t,n(r);}));}else {const t={model:a.model,apiKey:a.apiKey,contents:o.content};await async function geminiCompletion(t,n){const a=new GoogleGenAI({apiKey:t.apiKey}),o=await a.models.generateContentStream({model:t.model,contents:t.contents});for await(const r of o)n(r.text);n("\n[Translation completed]");}(t,(t=>{console.log("In progress..."),r+=t,n(r);}));}console.log("Done!");const s={url:window.location.href,title:document.title,cachedAt:Date.now(),...findPrevNextChapterLinks()};replaceAppState({isTranslating:!1,currentView:"reader"}),await(async(t,n)=>{try{if(!t?.url)return;let a=JSON.parse(localStorage.getItem("dichtruyen-ai:history")||"[]");a=a.filter((t=>t&&t.url));const o=a.findIndex((n=>n.url===t.url));-1!==o?a[o]=t:(a.length>=20&&a.shift(),a.push(t)),localStorage.setItem("dichtruyen-ai:history",JSON.stringify(a)),await db_set(`history:${t.url}`,t),await db_set(`translated:${t.url}`,n);}catch(a){console.error("Failed to save to history:",a);}})(s,r);}catch(a){console.error(a);}finally{replaceAppState({isTranslating:false});}};function findPrevNextChapterLinks(){const t=window.location.href,n=window.location.origin,a=t.split("/").pop()||"",o=t.replace(n,"").replace(a,""),r=document.getElementsByTagName("a"),s=[...new Set(Array.from(r).map((t=>t.href)).filter((t=>t&&-1!==t.lastIndexOf(`${n}${o}`))).filter((t=>{const a=t.split("/").pop();return t!==`${n}${o}`&&null!=a?.match(/\d+/)})).concat(t))].sort(((t,n)=>{const a=t.split("/").pop(),o=n.split("/").pop();return parseInt(a?.match(/\d+/)?.[0]??"0",10)-parseInt(o?.match(/\d+/)?.[0]??"0",10)}));if(2===s.length){if(s[0]===t)return {previous:null,next:s[1]};if(s[1]===t)return {previous:s[0],next:null}}else if(3===s.length&&s[1]===t)return {previous:s[0],next:s[2]};return {previous:null,next:null}}const fetchResource=async t=>await fetchApi(t,"text"),getRelease=async(t=false)=>{try{const n={apiURL:"https://api.github.com/repos/sourman-dev/dichtruyen-ai-userscript/releases/latest",apiType:"text",nameOfCache:"dichtruyen-ai:release",parseJSON:!0},a=await fetchAndCached(n,t),o={version:a.tag_name,description:a.body,fileUrl:a.assets[0]?.browser_download_url||null};return await ke.setValue("dichtruyen-ai:release",JSON.stringify(o)),o}catch(e){return {version:"0.0.4",description:null,fileUrl:null}}},Fe={version:"0.0.4",prompt:{systemPrompts:[],userPrompts:[{id:"default-0",name:"Default",content:"",selected:true}]},providers:[],readerView:{backgroundColor:"#F4F4F4",fontFamily:"system-ui",lineHeight:"1.2",fontSize:18,bionicReading:false,includeTitle:false}};let Ue;const Ge=reactive(Fe),He=reactive({currentView:"empty",isTranslating:false,openReaderConfig:false}),mergeProviders=async t=>{const n=await getAiProviders(true);return n?.providers&&(t.providers=n.providers.map((n=>{const a=t.providers.find((t=>t.name===n.name));return a&&(a.apiKey||a.selected)?{...n,apiKey:a.apiKey,selected:a.selected}:n}))),t},mergeSystemPrompt=async t=>{const n=await getSystemPrompt(true),a=t.prompt.systemPrompts.find((t=>"default-0"===t.id));return a?a.content=n:t.prompt.systemPrompts.push({id:"default-0",name:"Default",content:n,selected:true}),t},replaceAppState=t=>{replace(He,Object.assign(He,t));},replaceReaderState=t=>{replace(Ge.readerView,Object.assign({},Ge.readerView,t));};const{span:je,button:qe,div:$e}=p.tags,createIconButton=(t,n,a)=>qe({class:"icon-button",id:a||void 0,onclick:n},t);function changeView(t){const n=He.currentView===t?"empty":t;replaceAppState({currentView:n});}const iconEl=t=>je({class:"icon",style:`background-image: url('data:image/svg+xml;utf8,${t}');`}),We=iconEl('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>'),Ke=iconEl('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>'),Ye=iconEl('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>'),Je=iconEl('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M6 6h12v12H6z"/></svg>'),changeIcon=t=>{Array.from(document.querySelectorAll("*")).map((t=>t.shadowRoot)).filter((t=>null!==t)).forEach((n=>{const a=n.querySelector("#transButton");if(a){for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(t);}}));},{p:ze,div:Xe,button:Qe,select:Ze,option:et,label:tt,input:nt}=p.tags,at=[{name:"System ui",value:"system-ui"},{name:"Times New Roman",value:"Times New Roman"},{name:"Arial",value:"Arial"},{name:"Verdana",value:"Verdana"},{name:"Tahoma",value:"Tahoma"},{name:"Segoe UI",value:"Segoe UI"}],ot=[{name:"Light Gray",value:"#F4F4F4"},{name:"Light Blue",value:"#E8EBEE"},{name:"Deep Blue",value:"#E1E4F2"},{name:"Light Yellow",value:"#F4F4E3"},{name:"Sepia",value:"#EAE4D3"},{name:"Deep Yellow",value:"#FAFAC8"},{name:"Dark",value:"black"}],rt=["1.6","1","1.2","1.4","1.8","2"],openCloseModal=(t="none")=>{Array.from(document.querySelectorAll("*")).map((t=>t.shadowRoot)).filter((t=>null!==t)).forEach((n=>{const a=n.getElementById("mdlReaderContainer");a&&(a.style.display=t);}));},st=p.derive((()=>Ge.readerView));function ModalReaderConfig(){const t=p.state(false);return Xe({id:"mdlReaderContainer",style:"display: none"},(({closed:t,backgroundColor:n="rgba(0,0,0,.5)",blurBackground:a=false,clickBackgroundToClose:o=false,backgroundClass:r="",backgroundStyleOverrides:s={},modalClass:i="",modalStyleOverrides:l={}},...u)=>{const c={display:"flex","align-items":"center","justify-content":"center",left:0,right:0,top:0,bottom:0,position:"fixed","z-index":1e4,"background-color":n,"backdrop-filter":a?"blur(0.25rem)":"none",...s},h={"border-radius":"0.5rem",padding:"1rem",display:"block","background-color":"white",...l};return document.activeElement instanceof HTMLElement&&document.activeElement.blur(),()=>{if(t.val)return null;const n=P({class:r,style:toStyleStr(c)},P({class:i,style:toStyleStr(h)},u));return o&&n.addEventListener("click",(a=>a.target===n&&(t.val=true))),n}})({closed:t},Xe({class:"pure-g"},Xe({class:"pure-u-1 pure-u-md-1-2 p-1"},ze("Font Family"),Ze({class:"pure-input-1",onchange:t=>{replaceReaderState({fontFamily:t.target.value});}},at.map((t=>et({value:t.value,selected:()=>st.val.fontFamily===t.value},t.name))))),Xe({class:"pure-u-1 pure-u-md-1-2 p-1"},ze("Font Size"),Ze({class:"pure-input-1",onchange:t=>{replaceReaderState({fontSize:t.target.value});}},Array.from({length:15},((t,n)=>n+16)).map((t=>et({value:t,selected:()=>Number(st.val.fontSize)===t},`${t}px`))))),Xe({class:"pure-u-1 pure-u-md-1-2 p-1"},ze("Background Color"),Ze({class:"pure-input-1",onchange:t=>{replaceReaderState({backgroundColor:t.target.value});}},ot.map((t=>et({value:t.value,selected:()=>st.val.backgroundColor===t.value},t.name))))),Xe({class:"pure-u-1 pure-u-md-1-2 p-1"},ze("Line Height"),Ze({class:"pure-input-1",onchange:t=>{replaceReaderState({lineHeight:t.target.value});}},rt.map((t=>et({value:t,selected:()=>st.val.lineHeight===t},t))))),Xe({class:"pure-u-1 p-1",style:"margin: 5px 0px;"},tt({class:"pure-checkbox"},nt({type:"checkbox",checked:st.val.bionicReading,onchange:t=>{replaceReaderState({bionicReading:t.target.checked});}})," Fast Reader"))),Xe({style:"display: flex; justify-content: center;"},Qe({onclick:()=>replaceAppState({openReaderConfig:false})},"Ok"))))}p.derive((()=>{ true===He.openReaderConfig?openCloseModal("flex"):openCloseModal("none");}));const{div:it,style:lt,button:ut,a:ct}=p.tags,currentHistory=async()=>await db_get(`history:${window.location.href}`),createHistoryItem=(t,n)=>it({class:"history-item"},ct({href:t,class:"history-link",onclick:n=>{n.preventDefault(),window.location.href=t;}},n),ut({onclick:async function(){await(async t=>{try{await db_del(`history:${t}`),await db_del(`translated:${t}`);let n=JSON.parse(localStorage.getItem("dichtruyen-ai:history")||"[]");return n=n.filter((n=>n.url!==t)),localStorage.setItem("dichtruyen-ai:history",JSON.stringify(n)),!0}catch(n){throw console.error("Failed to delete history item:",n),n}})(t),window.location.reload();},class:"delete-button"},"❌"));e("history-view",(({})=>{let t=JSON.parse(localStorage.getItem("dichtruyen-ai:history")||"[]");return t=t.filter((t=>t.url!==window.location.href)),[lt("\n        .history-item {\n          padding: 0.5em;\n          margin: 0.5em 0;\n          border-bottom: 1px solid #eee;\n        }\n        .history-link {\n          text-decoration: none;\n          color: #333;\n          margin-right: 1em;\n        }\n        .delete-button {\n          float: right;\n          border: none;\n          background: none;\n          cursor: pointer;\n        }\n        .empty-label {\n          text-align: center;\n          padding: 2em;\n          color: #666;\n        }\n        .history-list {\n          max-height: 700px;\n          overflow-y: auto;\n          border-bottom: 3px solid #333;\n        }\n      "),it({class:"pure-g"},it({class:"pure-u-1 history-list"},0===t.length?it({class:"empty-label"},"Lịch sử trống"):t.map((t=>createHistoryItem(t.url,t.title)))),Await({value:currentHistory(),container:it},(t=>t&&createHistoryItem(t.url,t.title))))]}),false);var ht,dt={exports:{}};function requireReadability$1(){return ht||(ht=1,function(t){function Readability(t,n){if(n&&n.documentElement)t=n,n=arguments[2];else if(!t||!t.documentElement)throw new Error("First argument to Readability constructor should be a document object.");if(n=n||{},this._doc=t,this._docJSDOMParser=this._doc.firstChild.__JSDOMParser__,this._articleTitle=null,this._articleByline=null,this._articleDir=null,this._articleSiteName=null,this._attempts=[],this._metadata={},this._debug=!!n.debug,this._maxElemsToParse=n.maxElemsToParse||this.DEFAULT_MAX_ELEMS_TO_PARSE,this._nbTopCandidates=n.nbTopCandidates||this.DEFAULT_N_TOP_CANDIDATES,this._charThreshold=n.charThreshold||this.DEFAULT_CHAR_THRESHOLD,this._classesToPreserve=this.CLASSES_TO_PRESERVE.concat(n.classesToPreserve||[]),this._keepClasses=!!n.keepClasses,this._serializer=n.serializer||function(t){return t.innerHTML},this._disableJSONLD=!!n.disableJSONLD,this._allowedVideoRegex=n.allowedVideoRegex||this.REGEXPS.videos,this._linkDensityModifier=n.linkDensityModifier||0,this._flags=this.FLAG_STRIP_UNLIKELYS|this.FLAG_WEIGHT_CLASSES|this.FLAG_CLEAN_CONDITIONALLY,this._debug){let logNode=function(t){if(t.nodeType==t.TEXT_NODE)return `${t.nodeName} ("${t.textContent}")`;let n=Array.from(t.attributes||[],(function(t){return `${t.name}="${t.value}"`})).join(" ");return `<${t.localName} ${n}>`};this.log=function(){if("undefined"!=typeof console){let t=Array.from(arguments,(t=>t&&t.nodeType==this.ELEMENT_NODE?logNode(t):t));t.unshift("Reader: (Readability)"),console.log(...t);}else if("undefined"!=typeof dump){var t=Array.prototype.map.call(arguments,(function(t){return t&&t.nodeName?logNode(t):t})).join(" ");dump("Reader: (Readability) "+t+"\n");}};}else this.log=function(){};}Readability.prototype={FLAG_STRIP_UNLIKELYS:1,FLAG_WEIGHT_CLASSES:2,FLAG_CLEAN_CONDITIONALLY:4,ELEMENT_NODE:1,TEXT_NODE:3,DEFAULT_MAX_ELEMS_TO_PARSE:0,DEFAULT_N_TOP_CANDIDATES:5,DEFAULT_TAGS_TO_SCORE:"section,h2,h3,h4,h5,h6,p,td,pre".toUpperCase().split(","),DEFAULT_CHAR_THRESHOLD:500,REGEXPS:{unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i,positive:/article|body|content|entry|hentry|h-entry|main|page|pagination|post|text|blog|story/i,negative:/-ad-|hidden|^hid$| hid$| hid |^hid |banner|combx|comment|com-|contact|footer|gdpr|masthead|media|meta|outbrain|promo|related|scroll|share|shoutbox|sidebar|skyscraper|sponsor|shopping|tags|widget/i,extraneous:/print|archive|comment|discuss|e[\-]?mail|share|reply|all|login|sign|single|utility/i,byline:/byline|author|dateline|writtenby|p-author/i,replaceFonts:/<(\/?)font[^>]*>/gi,normalize:/\s{2,}/g,videos:/\/\/(www\.)?((dailymotion|youtube|youtube-nocookie|player\.vimeo|v\.qq)\.com|(archive|upload\.wikimedia)\.org|player\.twitch\.tv)/i,shareElements:/(\b|_)(share|sharedaddy)(\b|_)/i,nextLink:/(next|weiter|continue|>([^\|]|$)|»([^\|]|$))/i,prevLink:/(prev|earl|old|new|<|«)/i,tokenize:/\W+/g,whitespace:/^\s*$/,hasContent:/\S$/,hashUrl:/^#.+/,srcsetUrl:/(\S+)(\s+[\d.]+[xw])?(\s*(?:,|$))/g,b64DataUrl:/^data:\s*([^\s;,]+)\s*;\s*base64\s*,/i,commas:/\u002C|\u060C|\uFE50|\uFE10|\uFE11|\u2E41|\u2E34|\u2E32|\uFF0C/g,jsonLdArticleTypes:/^Article|AdvertiserContentArticle|NewsArticle|AnalysisNewsArticle|AskPublicNewsArticle|BackgroundNewsArticle|OpinionNewsArticle|ReportageNewsArticle|ReviewNewsArticle|Report|SatiricalArticle|ScholarlyArticle|MedicalScholarlyArticle|SocialMediaPosting|BlogPosting|LiveBlogPosting|DiscussionForumPosting|TechArticle|APIReference$/,adWords:/^(ad(vertising|vertisement)?|pub(licité)?|werb(ung)?|广告|Реклама|Anuncio)$/iu,loadingWords:/^((loading|正在加载|Загрузка|chargement|cargando)(…|\.\.\.)?)$/iu},UNLIKELY_ROLES:["menu","menubar","complementary","navigation","alert","alertdialog","dialog"],DIV_TO_P_ELEMS:new Set(["BLOCKQUOTE","DL","DIV","IMG","OL","P","PRE","TABLE","UL"]),ALTER_TO_DIV_EXCEPTIONS:["DIV","ARTICLE","SECTION","P","OL","UL"],PRESENTATIONAL_ATTRIBUTES:["align","background","bgcolor","border","cellpadding","cellspacing","frame","hspace","rules","style","valign","vspace"],DEPRECATED_SIZE_ATTRIBUTE_ELEMS:["TABLE","TH","TD","HR","PRE"],PHRASING_ELEMS:["ABBR","AUDIO","B","BDO","BR","BUTTON","CITE","CODE","DATA","DATALIST","DFN","EM","EMBED","I","IMG","INPUT","KBD","LABEL","MARK","MATH","METER","NOSCRIPT","OBJECT","OUTPUT","PROGRESS","Q","RUBY","SAMP","SCRIPT","SELECT","SMALL","SPAN","STRONG","SUB","SUP","TEXTAREA","TIME","VAR","WBR"],CLASSES_TO_PRESERVE:["page"],HTML_ESCAPE_MAP:{lt:"<",gt:">",amp:"&",quot:'"',apos:"'"},_postProcessContent(t){this._fixRelativeUris(t),this._simplifyNestedElements(t),this._keepClasses||this._cleanClasses(t);},_removeNodes(t,n){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _removeNodes");for(var a=t.length-1;a>=0;a--){var o=t[a],r=o.parentNode;r&&(n&&!n.call(this,o,a,t)||r.removeChild(o));}},_replaceNodeTags(t,n){if(this._docJSDOMParser&&t._isLiveNodeList)throw new Error("Do not pass live node lists to _replaceNodeTags");for(const a of t)this._setNodeTag(a,n);},_forEachNode(t,n){Array.prototype.forEach.call(t,n,this);},_findNode(t,n){return Array.prototype.find.call(t,n,this)},_someNode(t,n){return Array.prototype.some.call(t,n,this)},_everyNode(t,n){return Array.prototype.every.call(t,n,this)},_getAllNodesWithTag:(t,n)=>t.querySelectorAll?t.querySelectorAll(n.join(",")):[].concat.apply([],n.map((function(n){var a=t.getElementsByTagName(n);return Array.isArray(a)?a:Array.from(a)}))),_cleanClasses(t){var n=this._classesToPreserve,a=(t.getAttribute("class")||"").split(/\s+/).filter((t=>n.includes(t))).join(" ");for(a?t.setAttribute("class",a):t.removeAttribute("class"),t=t.firstElementChild;t;t=t.nextElementSibling)this._cleanClasses(t);},_isUrl(t){try{return new URL(t),!0}catch{return  false}},_fixRelativeUris(t){var n=this._doc.baseURI,a=this._doc.documentURI;function toAbsoluteURI(t){if(n==a&&"#"==t.charAt(0))return t;try{return new URL(t,n).href}catch(o){}return t}var o=this._getAllNodesWithTag(t,["a"]);this._forEachNode(o,(function(t){var n=t.getAttribute("href");if(n)if(0===n.indexOf("javascript:"))if(1===t.childNodes.length&&t.childNodes[0].nodeType===this.TEXT_NODE){var a=this._doc.createTextNode(t.textContent);t.parentNode.replaceChild(a,t);}else {for(var o=this._doc.createElement("span");t.firstChild;)o.appendChild(t.firstChild);t.parentNode.replaceChild(o,t);}else t.setAttribute("href",toAbsoluteURI(n));}));var r=this._getAllNodesWithTag(t,["img","picture","figure","video","audio","source"]);this._forEachNode(r,(function(t){var n=t.getAttribute("src"),a=t.getAttribute("poster"),o=t.getAttribute("srcset");if(n&&t.setAttribute("src",toAbsoluteURI(n)),a&&t.setAttribute("poster",toAbsoluteURI(a)),o){var r=o.replace(this.REGEXPS.srcsetUrl,(function(t,n,a,o){return toAbsoluteURI(n)+(a||"")+o}));t.setAttribute("srcset",r);}}));},_simplifyNestedElements(t){for(var n=t;n;){if(n.parentNode&&["DIV","SECTION"].includes(n.tagName)&&(!n.id||!n.id.startsWith("readability"))){if(this._isElementWithoutContent(n)){n=this._removeAndGetNext(n);continue}if(this._hasSingleTagInsideElement(n,"DIV")||this._hasSingleTagInsideElement(n,"SECTION")){for(var a=n.children[0],o=0;o<n.attributes.length;o++)a.setAttributeNode(n.attributes[o].cloneNode());n.parentNode.replaceChild(a,n),n=a;continue}}n=this._getNextNode(n);}},_getArticleTitle(){var t=this._doc,n="",a="";try{"string"!=typeof(n=a=t.title.trim())&&(n=a=this._getInnerText(t.getElementsByTagName("title")[0]));}catch(e){}var o=false;function wordCount(t){return t.split(/\s+/).length}if(/ [\|\-\\\/>»] /.test(n)){o=/ [\\\/>»] /.test(n);let t=Array.from(a.matchAll(/ [\|\-\\\/>»] /gi));wordCount(n=a.substring(0,t.pop().index))<3&&(n=a.replace(/^[^\|\-\\\/>»]*[\|\-\\\/>»]/gi,""));}else if(n.includes(": ")){var r=this._getAllNodesWithTag(t,["h1","h2"]),s=n.trim();this._someNode(r,(function(t){return t.textContent.trim()===s}))||(wordCount(n=a.substring(a.lastIndexOf(":")+1))<3?n=a.substring(a.indexOf(":")+1):wordCount(a.substr(0,a.indexOf(":")))>5&&(n=a));}else if(n.length>150||n.length<15){var i=t.getElementsByTagName("h1");1===i.length&&(n=this._getInnerText(i[0]));}var l=wordCount(n=n.trim().replace(this.REGEXPS.normalize," "));return l<=4&&(!o||l!=wordCount(a.replace(/[\|\-\\\/>»]+/g,""))-1)&&(n=a),n},_prepDocument(){var t=this._doc;this._removeNodes(this._getAllNodesWithTag(t,["style"])),t.body&&this._replaceBrs(t.body),this._replaceNodeTags(this._getAllNodesWithTag(t,["font"]),"SPAN");},_nextNode(t){for(var n=t;n&&n.nodeType!=this.ELEMENT_NODE&&this.REGEXPS.whitespace.test(n.textContent);)n=n.nextSibling;return n},_replaceBrs(t){this._forEachNode(this._getAllNodesWithTag(t,["br"]),(function(t){for(var n=t.nextSibling,a=false;(n=this._nextNode(n))&&"BR"==n.tagName;){a=true;var o=n.nextSibling;n.remove(),n=o;}if(a){var r=this._doc.createElement("p");for(t.parentNode.replaceChild(r,t),n=r.nextSibling;n;){if("BR"==n.tagName){var s=this._nextNode(n.nextSibling);if(s&&"BR"==s.tagName)break}if(!this._isPhrasingContent(n))break;var i=n.nextSibling;r.appendChild(n),n=i;}for(;r.lastChild&&this._isWhitespace(r.lastChild);)r.lastChild.remove();"P"===r.parentNode.tagName&&this._setNodeTag(r.parentNode,"DIV");}}));},_setNodeTag(t,n){if(this.log("_setNodeTag",t,n),this._docJSDOMParser)return t.localName=n.toLowerCase(),t.tagName=n.toUpperCase(),t;for(var a=t.ownerDocument.createElement(n);t.firstChild;)a.appendChild(t.firstChild);t.parentNode.replaceChild(a,t),t.readability&&(a.readability=t.readability);for(var o=0;o<t.attributes.length;o++)a.setAttributeNode(t.attributes[o].cloneNode());return a},_prepArticle(t){this._cleanStyles(t),this._markDataTables(t),this._fixLazyImages(t),this._cleanConditionally(t,"form"),this._cleanConditionally(t,"fieldset"),this._clean(t,"object"),this._clean(t,"embed"),this._clean(t,"footer"),this._clean(t,"link"),this._clean(t,"aside");var n=this.DEFAULT_CHAR_THRESHOLD;this._forEachNode(t.children,(function(t){this._cleanMatchedNodes(t,(function(t,a){return this.REGEXPS.shareElements.test(a)&&t.textContent.length<n}));})),this._clean(t,"iframe"),this._clean(t,"input"),this._clean(t,"textarea"),this._clean(t,"select"),this._clean(t,"button"),this._cleanHeaders(t),this._cleanConditionally(t,"table"),this._cleanConditionally(t,"ul"),this._cleanConditionally(t,"div"),this._replaceNodeTags(this._getAllNodesWithTag(t,["h1"]),"h2"),this._removeNodes(this._getAllNodesWithTag(t,["p"]),(function(t){return 0===this._getAllNodesWithTag(t,["img","embed","object","iframe"]).length&&!this._getInnerText(t,false)})),this._forEachNode(this._getAllNodesWithTag(t,["br"]),(function(t){var n=this._nextNode(t.nextSibling);n&&"P"==n.tagName&&t.remove();})),this._forEachNode(this._getAllNodesWithTag(t,["table"]),(function(t){var n=this._hasSingleTagInsideElement(t,"TBODY")?t.firstElementChild:t;if(this._hasSingleTagInsideElement(n,"TR")){var a=n.firstElementChild;if(this._hasSingleTagInsideElement(a,"TD")){var o=a.firstElementChild;o=this._setNodeTag(o,this._everyNode(o.childNodes,this._isPhrasingContent)?"P":"DIV"),t.parentNode.replaceChild(o,t);}}}));},_initializeNode(t){switch(t.readability={contentScore:0},t.tagName){case "DIV":t.readability.contentScore+=5;break;case "PRE":case "TD":case "BLOCKQUOTE":t.readability.contentScore+=3;break;case "ADDRESS":case "OL":case "UL":case "DL":case "DD":case "DT":case "LI":case "FORM":t.readability.contentScore-=3;break;case "H1":case "H2":case "H3":case "H4":case "H5":case "H6":case "TH":t.readability.contentScore-=5;}t.readability.contentScore+=this._getClassWeight(t);},_removeAndGetNext(t){var n=this._getNextNode(t,true);return t.remove(),n},_getNextNode(t,n){if(!n&&t.firstElementChild)return t.firstElementChild;if(t.nextElementSibling)return t.nextElementSibling;do{t=t.parentNode;}while(t&&!t.nextElementSibling);return t&&t.nextElementSibling},_textSimilarity(t,n){var a=t.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean),o=n.toLowerCase().split(this.REGEXPS.tokenize).filter(Boolean);return a.length&&o.length?1-o.filter((t=>!a.includes(t))).join(" ").length/o.join(" ").length:0},_isValidByline(t,n){var a=t.getAttribute("rel"),o=t.getAttribute("itemprop"),r=t.textContent.trim().length;return ("author"===a||o&&o.includes("author")||this.REGEXPS.byline.test(n))&&!!r&&r<100},_getNodeAncestors(t,n){n=n||0;for(var a=0,o=[];t.parentNode&&(o.push(t.parentNode),!n||++a!==n);)t=t.parentNode;return o},_grabArticle(t){this.log("**** grabArticle ****");var n=this._doc,a=null!==t;if(!(t=t||this._doc.body))return this.log("No body found in document. Abort."),null;for(var o=t.innerHTML;;){this.log("Starting grabArticle loop");var r=this._flagIsActive(this.FLAG_STRIP_UNLIKELYS),s=[],i=this._doc.documentElement;let ae=true;for(;i;){"HTML"===i.tagName&&(this._articleLang=i.getAttribute("lang"));var l=i.className+" "+i.id;if(this._isProbablyVisible(i))if("true"!=i.getAttribute("aria-modal")||"dialog"!=i.getAttribute("role"))if(this._articleByline||this._metadata.byline||!this._isValidByline(i,l))if(ae&&this._headerDuplicatesTitle(i))this.log("Removing header: ",i.textContent.trim(),this._articleTitle.trim()),ae=false,i=this._removeAndGetNext(i);else {if(r){if(this.REGEXPS.unlikelyCandidates.test(l)&&!this.REGEXPS.okMaybeItsACandidate.test(l)&&!this._hasAncestorTag(i,"table")&&!this._hasAncestorTag(i,"code")&&"BODY"!==i.tagName&&"A"!==i.tagName){this.log("Removing unlikely candidate - "+l),i=this._removeAndGetNext(i);continue}if(this.UNLIKELY_ROLES.includes(i.getAttribute("role"))){this.log("Removing content with role "+i.getAttribute("role")+" - "+l),i=this._removeAndGetNext(i);continue}}if("DIV"!==i.tagName&&"SECTION"!==i.tagName&&"HEADER"!==i.tagName&&"H1"!==i.tagName&&"H2"!==i.tagName&&"H3"!==i.tagName&&"H4"!==i.tagName&&"H5"!==i.tagName&&"H6"!==i.tagName||!this._isElementWithoutContent(i)){if(this.DEFAULT_TAGS_TO_SCORE.includes(i.tagName)&&s.push(i),"DIV"===i.tagName){for(var u=null,c=i.firstChild;c;){var h=c.nextSibling;if(this._isPhrasingContent(c))null!==u?u.appendChild(c):this._isWhitespace(c)||(u=n.createElement("p"),i.replaceChild(u,c),u.appendChild(c));else if(null!==u){for(;u.lastChild&&this._isWhitespace(u.lastChild);)u.lastChild.remove();u=null;}c=h;}if(this._hasSingleTagInsideElement(i,"P")&&this._getLinkDensity(i)<.25){var d=i.children[0];i.parentNode.replaceChild(d,i),i=d,s.push(i);}else this._hasChildBlockElement(i)||(i=this._setNodeTag(i,"P"),s.push(i));}i=this._getNextNode(i);}else i=this._removeAndGetNext(i);}else {for(var p=this._getNextNode(i,true),g=this._getNextNode(i),P=null;g&&g!=p;){var V=g.getAttribute("itemprop");if(V&&V.includes("name")){P=g;break}g=this._getNextNode(g);}this._articleByline=(P??i).textContent.trim(),i=this._removeAndGetNext(i);}else i=this._removeAndGetNext(i);else this.log("Removing hidden node - "+l),i=this._removeAndGetNext(i);}var B=[];this._forEachNode(s,(function(t){if(t.parentNode&&void 0!==t.parentNode.tagName){var n=this._getInnerText(t);if(!(n.length<25)){var a=this._getNodeAncestors(t,5);if(0!==a.length){var o=0;o+=1,o+=n.split(this.REGEXPS.commas).length,o+=Math.min(Math.floor(n.length/100),3),this._forEachNode(a,(function(t,n){if(t.tagName&&t.parentNode&&void 0!==t.parentNode.tagName){if(void 0===t.readability&&(this._initializeNode(t),B.push(t)),0===n)var a=1;else a=1===n?2:3*n;t.readability.contentScore+=o/a;}}));}}}}));for(var v=[],C=0,b=B.length;C<b;C+=1){var E=B[C],T=E.readability.contentScore*(1-this._getLinkDensity(E));E.readability.contentScore=T,this.log("Candidate:",E,"with score "+T);for(var A=0;A<this._nbTopCandidates;A++){var w=v[A];if(!w||T>w.readability.contentScore){v.splice(A,0,E),v.length>this._nbTopCandidates&&v.pop();break}}}var S,O=v[0]||null,x=false;if(null===O||"BODY"===O.tagName){for(O=n.createElement("DIV"),x=true;t.firstChild;)this.log("Moving child out:",t.firstChild),O.appendChild(t.firstChild);t.appendChild(O),this._initializeNode(O);}else if(O){for(var I=[],R=1;R<v.length;R++)v[R].readability.contentScore/O.readability.contentScore>=.75&&I.push(this._getNodeAncestors(v[R]));if(I.length>=3)for(S=O.parentNode;"BODY"!==S.tagName;){for(var M=0,L=0;L<I.length&&M<3;L++)M+=Number(I[L].includes(S));if(M>=3){O=S;break}S=S.parentNode;}O.readability||this._initializeNode(O),S=O.parentNode;for(var D=O.readability.contentScore,k=D/3;"BODY"!==S.tagName;)if(S.readability){var F=S.readability.contentScore;if(F<k)break;if(F>D){O=S;break}D=S.readability.contentScore,S=S.parentNode;}else S=S.parentNode;for(S=O.parentNode;"BODY"!=S.tagName&&1==S.children.length;)S=(O=S).parentNode;O.readability||this._initializeNode(O);}var G=n.createElement("DIV");a&&(G.id="readability-content");for(var j=Math.max(10,.2*O.readability.contentScore),q=(S=O.parentNode).children,$=0,W=q.length;$<W;$++){var K=q[$],Y=false;if(this.log("Looking at sibling node:",K,K.readability?"with score "+K.readability.contentScore:""),this.log("Sibling has score",K.readability?K.readability.contentScore:"Unknown"),K===O)Y=true;else {var J=0;if(K.className===O.className&&""!==O.className&&(J+=.2*O.readability.contentScore),K.readability&&K.readability.contentScore+J>=j)Y=true;else if("P"===K.nodeName){var z=this._getLinkDensity(K),X=this._getInnerText(K),Q=X.length;(Q>80&&z<.25||Q<80&&Q>0&&0===z&&-1!==X.search(/\.( |$)/))&&(Y=true);}}Y&&(this.log("Appending node:",K),this.ALTER_TO_DIV_EXCEPTIONS.includes(K.nodeName)||(this.log("Altering sibling:",K,"to div."),K=this._setNodeTag(K,"DIV")),G.appendChild(K),q=S.children,$-=1,W-=1);}if(this._debug&&this.log("Article content pre-prep: "+G.innerHTML),this._prepArticle(G),this._debug&&this.log("Article content post-prep: "+G.innerHTML),x)O.id="readability-page-1",O.className="page";else {var Z=n.createElement("DIV");for(Z.id="readability-page-1",Z.className="page";G.firstChild;)Z.appendChild(G.firstChild);G.appendChild(Z);}this._debug&&this.log("Article content after paging: "+G.innerHTML);var ee=true,te=this._getInnerText(G,true).length;if(te<this._charThreshold)if(ee=false,t.innerHTML=o,this._attempts.push({articleContent:G,textLength:te}),this._flagIsActive(this.FLAG_STRIP_UNLIKELYS))this._removeFlag(this.FLAG_STRIP_UNLIKELYS);else if(this._flagIsActive(this.FLAG_WEIGHT_CLASSES))this._removeFlag(this.FLAG_WEIGHT_CLASSES);else if(this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY))this._removeFlag(this.FLAG_CLEAN_CONDITIONALLY);else {if(this._attempts.sort((function(t,n){return n.textLength-t.textLength})),!this._attempts[0].textLength)return null;G=this._attempts[0].articleContent,ee=true;}if(ee){var ne=[S,O].concat(this._getNodeAncestors(S));return this._someNode(ne,(function(t){if(!t.tagName)return  false;var n=t.getAttribute("dir");return !!n&&(this._articleDir=n,true)})),G}}},_unescapeHtmlEntities(t){if(!t)return t;var n=this.HTML_ESCAPE_MAP;return t.replace(/&(quot|amp|apos|lt|gt);/g,(function(t,a){return n[a]})).replace(/&#(?:x([0-9a-f]+)|([0-9]+));/gi,(function(t,n,a){var o=parseInt(n||a,n?16:10);return (0==o||o>1114111||o>=55296&&o<=57343)&&(o=65533),String.fromCodePoint(o)}))},_getJSONLD(t){var n,a=this._getAllNodesWithTag(t,["script"]);return this._forEachNode(a,(function(t){if(!n&&"application/ld+json"===t.getAttribute("type"))try{var a=t.textContent.replace(/^\s*<!\[CDATA\[|\]\]>\s*$/g,""),o=JSON.parse(a);if(Array.isArray(o)&&!(o=o.find((t=>t["@type"]&&t["@type"].match(this.REGEXPS.jsonLdArticleTypes)))))return;var r=/^https?\:\/\/schema\.org\/?$/;if(!("string"==typeof o["@context"]&&o["@context"].match(r)||"object"==typeof o["@context"]&&"string"==typeof o["@context"]["@vocab"]&&o["@context"]["@vocab"].match(r)))return;if(!o["@type"]&&Array.isArray(o["@graph"])&&(o=o["@graph"].find((t=>(t["@type"]||"").match(this.REGEXPS.jsonLdArticleTypes)))),!o||!o["@type"]||!o["@type"].match(this.REGEXPS.jsonLdArticleTypes))return;if(n={},"string"==typeof o.name&&"string"==typeof o.headline&&o.name!==o.headline){var s=this._getArticleTitle(),i=this._textSimilarity(o.name,s)>.75,l=this._textSimilarity(o.headline,s)>.75;n.title=l&&!i?o.headline:o.name;}else "string"==typeof o.name?n.title=o.name.trim():"string"==typeof o.headline&&(n.title=o.headline.trim());o.author&&("string"==typeof o.author.name?n.byline=o.author.name.trim():Array.isArray(o.author)&&o.author[0]&&"string"==typeof o.author[0].name&&(n.byline=o.author.filter((function(t){return t&&"string"==typeof t.name})).map((function(t){return t.name.trim()})).join(", "))),"string"==typeof o.description&&(n.excerpt=o.description.trim()),o.publisher&&"string"==typeof o.publisher.name&&(n.siteName=o.publisher.name.trim()),"string"==typeof o.datePublished&&(n.datePublished=o.datePublished.trim());}catch(u){this.log(u.message);}})),n||{}},_getArticleMetadata(t){var n={},a={},o=this._doc.getElementsByTagName("meta"),r=/\s*(article|dc|dcterm|og|twitter)\s*:\s*(author|creator|description|published_time|title|site_name)\s*/gi,s=/^\s*(?:(dc|dcterm|og|twitter|parsely|weibo:(article|webpage))\s*[-\.:]\s*)?(author|creator|pub-date|description|title|site_name)\s*$/i;this._forEachNode(o,(function(t){var n=t.getAttribute("name"),o=t.getAttribute("property"),i=t.getAttribute("content");if(i){var l=null,u=null;o&&(l=o.match(r))&&(u=l[0].toLowerCase().replace(/\s/g,""),a[u]=i.trim()),!l&&n&&s.test(n)&&(u=n,i&&(u=u.toLowerCase().replace(/\s/g,"").replace(/\./g,":"),a[u]=i.trim()));}})),n.title=t.title||a["dc:title"]||a["dcterm:title"]||a["og:title"]||a["weibo:article:title"]||a["weibo:webpage:title"]||a.title||a["twitter:title"]||a["parsely-title"],n.title||(n.title=this._getArticleTitle());const i="string"!=typeof a["article:author"]||this._isUrl(a["article:author"])?void 0:a["article:author"];return n.byline=t.byline||a["dc:creator"]||a["dcterm:creator"]||a.author||a["parsely-author"]||i,n.excerpt=t.excerpt||a["dc:description"]||a["dcterm:description"]||a["og:description"]||a["weibo:article:description"]||a["weibo:webpage:description"]||a.description||a["twitter:description"],n.siteName=t.siteName||a["og:site_name"],n.publishedTime=t.datePublished||a["article:published_time"]||a["parsely-pub-date"]||null,n.title=this._unescapeHtmlEntities(n.title),n.byline=this._unescapeHtmlEntities(n.byline),n.excerpt=this._unescapeHtmlEntities(n.excerpt),n.siteName=this._unescapeHtmlEntities(n.siteName),n.publishedTime=this._unescapeHtmlEntities(n.publishedTime),n},_isSingleImage(t){for(;t;){if("IMG"===t.tagName)return  true;if(1!==t.children.length||""!==t.textContent.trim())return  false;t=t.children[0];}return  false},_unwrapNoscriptImages(t){var n=Array.from(t.getElementsByTagName("img"));this._forEachNode(n,(function(t){for(var n=0;n<t.attributes.length;n++){var a=t.attributes[n];switch(a.name){case "src":case "srcset":case "data-src":case "data-srcset":return}if(/\.(jpg|jpeg|png|webp)/i.test(a.value))return}t.remove();}));var a=Array.from(t.getElementsByTagName("noscript"));this._forEachNode(a,(function(n){if(this._isSingleImage(n)){var a=t.createElement("div");a.innerHTML=n.innerHTML;var o=n.previousElementSibling;if(o&&this._isSingleImage(o)){var r=o;"IMG"!==r.tagName&&(r=o.getElementsByTagName("img")[0]);for(var s=a.getElementsByTagName("img")[0],i=0;i<r.attributes.length;i++){var l=r.attributes[i];if(""!==l.value&&("src"===l.name||"srcset"===l.name||/\.(jpg|jpeg|png|webp)/i.test(l.value))){if(s.getAttribute(l.name)===l.value)continue;var u=l.name;s.hasAttribute(u)&&(u="data-old-"+u),s.setAttribute(u,l.value);}}n.parentNode.replaceChild(a.firstElementChild,o);}}}));},_removeScripts(t){this._removeNodes(this._getAllNodesWithTag(t,["script","noscript"]));},_hasSingleTagInsideElement(t,n){return 1==t.children.length&&t.children[0].tagName===n&&!this._someNode(t.childNodes,(function(t){return t.nodeType===this.TEXT_NODE&&this.REGEXPS.hasContent.test(t.textContent)}))},_isElementWithoutContent(t){return !(t.nodeType!==this.ELEMENT_NODE||t.textContent.trim().length||t.children.length&&t.children.length!=t.getElementsByTagName("br").length+t.getElementsByTagName("hr").length)},_hasChildBlockElement(t){return this._someNode(t.childNodes,(function(t){return this.DIV_TO_P_ELEMS.has(t.tagName)||this._hasChildBlockElement(t)}))},_isPhrasingContent(t){return t.nodeType===this.TEXT_NODE||this.PHRASING_ELEMS.includes(t.tagName)||("A"===t.tagName||"DEL"===t.tagName||"INS"===t.tagName)&&this._everyNode(t.childNodes,this._isPhrasingContent)},_isWhitespace(t){return t.nodeType===this.TEXT_NODE&&0===t.textContent.trim().length||t.nodeType===this.ELEMENT_NODE&&"BR"===t.tagName},_getInnerText(t,n){n=void 0===n||n;var a=t.textContent.trim();return n?a.replace(this.REGEXPS.normalize," "):a},_getCharCount(t,n){return n=n||",",this._getInnerText(t).split(n).length-1},_cleanStyles(t){if(t&&"svg"!==t.tagName.toLowerCase()){for(var n=0;n<this.PRESENTATIONAL_ATTRIBUTES.length;n++)t.removeAttribute(this.PRESENTATIONAL_ATTRIBUTES[n]);this.DEPRECATED_SIZE_ATTRIBUTE_ELEMS.includes(t.tagName)&&(t.removeAttribute("width"),t.removeAttribute("height"));for(var a=t.firstElementChild;null!==a;)this._cleanStyles(a),a=a.nextElementSibling;}},_getLinkDensity(t){var n=this._getInnerText(t).length;if(0===n)return 0;var a=0;return this._forEachNode(t.getElementsByTagName("a"),(function(t){var n=t.getAttribute("href"),o=n&&this.REGEXPS.hashUrl.test(n)?.3:1;a+=this._getInnerText(t).length*o;})),a/n},_getClassWeight(t){if(!this._flagIsActive(this.FLAG_WEIGHT_CLASSES))return 0;var n=0;return "string"==typeof t.className&&""!==t.className&&(this.REGEXPS.negative.test(t.className)&&(n-=25),this.REGEXPS.positive.test(t.className)&&(n+=25)),"string"==typeof t.id&&""!==t.id&&(this.REGEXPS.negative.test(t.id)&&(n-=25),this.REGEXPS.positive.test(t.id)&&(n+=25)),n},_clean(t,n){var a=["object","embed","iframe"].includes(n);this._removeNodes(this._getAllNodesWithTag(t,[n]),(function(t){if(a){for(var n=0;n<t.attributes.length;n++)if(this._allowedVideoRegex.test(t.attributes[n].value))return  false;if("object"===t.tagName&&this._allowedVideoRegex.test(t.innerHTML))return  false}return  true}));},_hasAncestorTag(t,n,a,o){a=a||3,n=n.toUpperCase();for(var r=0;t.parentNode;){if(a>0&&r>a)return  false;if(t.parentNode.tagName===n&&(!o||o(t.parentNode)))return  true;t=t.parentNode,r++;}return  false},_getRowAndColumnCount(t){for(var n=0,a=0,o=t.getElementsByTagName("tr"),r=0;r<o.length;r++){var s=o[r].getAttribute("rowspan")||0;s&&(s=parseInt(s,10)),n+=s||1;for(var i=0,l=o[r].getElementsByTagName("td"),u=0;u<l.length;u++){var c=l[u].getAttribute("colspan")||0;c&&(c=parseInt(c,10)),i+=c||1;}a=Math.max(a,i);}return {rows:n,columns:a}},_markDataTables(t){for(var n=t.getElementsByTagName("table"),a=0;a<n.length;a++){var o=n[a];if("presentation"!=o.getAttribute("role"))if("0"!=o.getAttribute("datatable"))if(o.getAttribute("summary"))o._readabilityDataTable=true;else {var r=o.getElementsByTagName("caption")[0];if(r&&r.childNodes.length)o._readabilityDataTable=true;else {if(["col","colgroup","tfoot","thead","th"].some((function(t){return !!o.getElementsByTagName(t)[0]})))this.log("Data table because found data-y descendant"),o._readabilityDataTable=true;else if(o.getElementsByTagName("table")[0])o._readabilityDataTable=false;else {var s=this._getRowAndColumnCount(o);1!=s.columns&&1!=s.rows?s.rows>=10||s.columns>4?o._readabilityDataTable=true:o._readabilityDataTable=s.rows*s.columns>10:o._readabilityDataTable=false;}}}else o._readabilityDataTable=false;else o._readabilityDataTable=false;}},_fixLazyImages(t){this._forEachNode(this._getAllNodesWithTag(t,["img","picture","figure"]),(function(t){if(t.src&&this.REGEXPS.b64DataUrl.test(t.src)){var n=this.REGEXPS.b64DataUrl.exec(t.src);if("image/svg+xml"===n[1])return;for(var a=false,o=0;o<t.attributes.length;o++){var r=t.attributes[o];if("src"!==r.name&&/\.(jpg|jpeg|png|webp)/i.test(r.value)){a=true;break}}if(a){var s=n[0].length;t.src.length-s<133&&t.removeAttribute("src");}}if(!(t.src||t.srcset&&"null"!=t.srcset)||t.className.toLowerCase().includes("lazy"))for(var i=0;i<t.attributes.length;i++)if("src"!==(r=t.attributes[i]).name&&"srcset"!==r.name&&"alt"!==r.name){var l=null;if(/\.(jpg|jpeg|png|webp)\s+\d/.test(r.value)?l="srcset":/^\s*\S+\.(jpg|jpeg|png|webp)\S*\s*$/.test(r.value)&&(l="src"),l)if("IMG"===t.tagName||"PICTURE"===t.tagName)t.setAttribute(l,r.value);else if("FIGURE"===t.tagName&&!this._getAllNodesWithTag(t,["img","picture"]).length){var u=this._doc.createElement("img");u.setAttribute(l,r.value),t.appendChild(u);}}}));},_getTextDensity(t,n){var a=this._getInnerText(t,true).length;if(0===a)return 0;var o=0,r=this._getAllNodesWithTag(t,n);return this._forEachNode(r,(t=>o+=this._getInnerText(t,true).length)),o/a},_cleanConditionally(t,n){this._flagIsActive(this.FLAG_CLEAN_CONDITIONALLY)&&this._removeNodes(this._getAllNodesWithTag(t,[n]),(function(t){var isDataTable=function(t){return t._readabilityDataTable},a="ul"===n||"ol"===n;if(!a){var o=0,r=this._getAllNodesWithTag(t,["ul","ol"]);this._forEachNode(r,(t=>o+=this._getInnerText(t).length)),a=o/this._getInnerText(t).length>.9;}if("table"===n&&isDataTable(t))return  false;if(this._hasAncestorTag(t,"table",-1,isDataTable))return  false;if(this._hasAncestorTag(t,"code"))return  false;if([...t.getElementsByTagName("table")].some((t=>t._readabilityDataTable)))return  false;var s=this._getClassWeight(t);this.log("Cleaning Conditionally",t);if(s+0<0)return  true;if(this._getCharCount(t,",")<10){for(var i=t.getElementsByTagName("p").length,l=t.getElementsByTagName("img").length,u=t.getElementsByTagName("li").length-100,c=t.getElementsByTagName("input").length,h=this._getTextDensity(t,["h1","h2","h3","h4","h5","h6"]),d=0,p=this._getAllNodesWithTag(t,["object","embed","iframe"]),g=0;g<p.length;g++){for(var P=0;P<p[g].attributes.length;P++)if(this._allowedVideoRegex.test(p[g].attributes[P].value))return  false;if("object"===p[g].tagName&&this._allowedVideoRegex.test(p[g].innerHTML))return  false;d++;}var V=this._getInnerText(t);if(this.REGEXPS.adWords.test(V)||this.REGEXPS.loadingWords.test(V))return  true;var B=V.length,v=this._getLinkDensity(t),C=["SPAN","LI","TD"].concat(Array.from(this.DIV_TO_P_ELEMS)),b=this._getTextDensity(t,C),E=this._hasAncestorTag(t,"figure");var T=(()=>{const t=[];return !E&&l>1&&i/l<.5&&t.push(`Bad p to img ratio (img=${l}, p=${i})`),!a&&u>i&&t.push(`Too many li's outside of a list. (li=${u} > p=${i})`),c>Math.floor(i/3)&&t.push(`Too many inputs per p. (input=${c}, p=${i})`),!a&&!E&&h<.9&&B<25&&(0===l||l>2)&&v>0&&t.push(`Suspiciously short. (headingDensity=${h}, img=${l}, linkDensity=${v})`),!a&&s<25&&v>.2+this._linkDensityModifier&&t.push(`Low weight and a little linky. (linkDensity=${v})`),s>=25&&v>.5+this._linkDensityModifier&&t.push(`High weight and mostly links. (linkDensity=${v})`),(1===d&&B<75||d>1)&&t.push(`Suspicious embed. (embedCount=${d}, contentLength=${B})`),0===l&&0===b&&t.push(`No useful content. (img=${l}, textDensity=${b})`),!!t.length&&(this.log("Checks failed",t),true)})();if(a&&T){for(var A=0;A<t.children.length;A++){if(t.children[A].children.length>1)return T}let n=t.getElementsByTagName("li").length;if(l==n)return  false}return T}return  false}));},_cleanMatchedNodes(t,n){for(var a=this._getNextNode(t,true),o=this._getNextNode(t);o&&o!=a;)o=n.call(this,o,o.className+" "+o.id)?this._removeAndGetNext(o):this._getNextNode(o);},_cleanHeaders(t){let n=this._getAllNodesWithTag(t,["h1","h2"]);this._removeNodes(n,(function(t){let n=this._getClassWeight(t)<0;return n&&this.log("Removing header with low class weight:",t),n}));},_headerDuplicatesTitle(t){if("H1"!=t.tagName&&"H2"!=t.tagName)return  false;var n=this._getInnerText(t,false);return this.log("Evaluating similarity of header:",n,this._articleTitle),this._textSimilarity(this._articleTitle,n)>.75},_flagIsActive(t){return (this._flags&t)>0},_removeFlag(t){this._flags=this._flags&~t;},_isProbablyVisible:t=>(!t.style||"none"!=t.style.display)&&(!t.style||"hidden"!=t.style.visibility)&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||"true"!=t.getAttribute("aria-hidden")||t.className&&t.className.includes&&t.className.includes("fallback-image")),parse(){if(this._maxElemsToParse>0){var t=this._doc.getElementsByTagName("*").length;if(t>this._maxElemsToParse)throw new Error("Aborting parsing document; "+t+" elements found")}this._unwrapNoscriptImages(this._doc);var n=this._disableJSONLD?{}:this._getJSONLD(this._doc);this._removeScripts(this._doc),this._prepDocument();var a=this._getArticleMetadata(n);this._metadata=a,this._articleTitle=a.title;var o=this._grabArticle();if(!o)return null;if(this.log("Grabbed: "+o.innerHTML),this._postProcessContent(o),!a.excerpt){var r=o.getElementsByTagName("p");r.length&&(a.excerpt=r[0].textContent.trim());}var s=o.textContent;return {title:this._articleTitle,byline:a.byline||this._articleByline,dir:this._articleDir,lang:this._articleLang,content:this._serializer(o),textContent:s,length:s.length,excerpt:a.excerpt,siteName:a.siteName||this._articleSiteName,publishedTime:a.publishedTime}}},t.exports=Readability;}(dt)),dt.exports}var pt,gt,yt,mt={exports:{}};var ft=function requireReadability(){if(yt)return gt;yt=1;var t=requireReadability$1(),n=function requireReadabilityReaderable(){return pt||(pt=1,function(){var t={unlikelyCandidates:/-ad-|ai2html|banner|breadcrumbs|combx|comment|community|cover-wrap|disqus|extra|footer|gdpr|header|legends|menu|related|remark|replies|rss|shoutbox|sidebar|skyscraper|social|sponsor|supplemental|ad-break|agegate|pagination|pager|popup|yom-remote/i,okMaybeItsACandidate:/and|article|body|column|content|main|shadow/i};function isNodeVisible(t){return (!t.style||"none"!=t.style.display)&&!t.hasAttribute("hidden")&&(!t.hasAttribute("aria-hidden")||"true"!=t.getAttribute("aria-hidden")||t.className&&t.className.includes&&t.className.includes("fallback-image"))}mt.exports=function isProbablyReaderable(n,a={}){"function"==typeof a&&(a={visibilityChecker:a});var o={minScore:20,minContentLength:140,visibilityChecker:isNodeVisible};a=Object.assign(o,a);var r=n.querySelectorAll("p, pre, article"),s=n.querySelectorAll("div > br");if(s.length){var i=new Set(r);[].forEach.call(s,(function(t){i.add(t.parentNode);})),r=Array.from(i);}var l=0;return [].some.call(r,(function(n){if(!a.visibilityChecker(n))return  false;var o=n.className+" "+n.id;if(t.unlikelyCandidates.test(o)&&!t.okMaybeItsACandidate.test(o))return  false;if(n.matches("li p"))return  false;var r=n.textContent.trim().length;return !(r<a.minContentLength)&&(l+=Math.sqrt(r-a.minContentLength))>a.minScore}))};}()),mt.exports}();return gt={Readability:t,isProbablyReaderable:n}}();const f=t=>null==t||""===t,_=(t,n)=>Object.keys(t).reduce(((t,a)=>(n(t[a])&&delete t[a],t)),t),Pt=["<b>","</b>"],y=t=>((t,n)=>({...n,..._(t,f)}))(t,{sep:Pt,fixationPoint:1,ignoreHtmlTag:true,ignoreHtmlEntity:true}),Vt=[[0,4,12,17,24,29,35,42,48],[1,2,7,10,13,14,19,22,25,28,31,34,37,40,43,46,49],[1,2,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47,49],[0,2,4,5,6,8,9,11,14,15,17,18,20,0,21,23,24,26,27,29,30,32,33,35,36,38,39,41,42,44,45,47,48],[0,2,3,5,6,7,8,10,11,12,14,15,17,19,20,21,23,24,25,26,28,29,30,32,33,34,35,37,38,39,41,42,43,44,46,47,48]],H=(t,n)=>{const{length:a}=t,o=Vt[n-1]??Vt[0],r=o.findIndex((t=>a<=t));let s=a-r;return  -1===r&&(s=a-o.length),Math.max(s,0)},N=(t,n)=>"string"==typeof n?`${n}${t}${n}`:`${n[0]}${t}${n[1]}`,m=t=>Array.from(t).map((t=>{const n=t.index,[a]=t,{length:o}=a;return [n,n+o-1]})),Bt=/(<!--[\s\S]*?-->)|(<[^>]*>)/g,vt=/(&[\w#]+;)/g,Ct=/(\p{L}|\p{Nd})*\p{L}(\p{L}|\p{Nd})*/gu,U=(t,n={})=>{if(null==t||!t.length)return "";const{fixationPoint:a,sep:o,ignoreHtmlTag:r,ignoreHtmlEntity:s}=y(n),i=Array.from(t.matchAll(Ct));let l,u,c="",h=0;r&&(l=(t=>{const n=t.matchAll(Bt),a=m(n).reverse();return t=>{const n=t.index,o=a.find((([t])=>n>t));if(!o)return  false;const[,r]=o;return n<r}})(t)),s&&(u=(t=>{const n=t.matchAll(vt),a=m(n).reverse();return t=>{const n=t.index,o=a.find((([t])=>n>t));if(!o)return  false;const[,r]=o;return n<r}})(t));for(const d of i){if((null==l?void 0:l(d))||(null==u?void 0:u(d)))continue;const[n]=d,r=d.index,s=r+H(n,a);c+=t.slice(h,r),r!==s&&(c+=N(t.slice(r,s),o)),h=s;}return c+t.slice(h)},{div:_t,button:bt,span:Et}=p.tags,render=()=>{const t=findPrevNextChapterLinks(),n=_t({class:"config-chapter-link",style:"display: none; justify-content: center; align-items: center; margin: 5px 0; gap: 10px;"});return t.previous||t.next?(n.appendChild(chapterButton("<",t.previous)),n.appendChild(configButton()),n.appendChild(chapterButton(">",t.next))):n.appendChild(configButton()),n},visbile=()=>{Array.from(document.querySelectorAll("*")).map((t=>t.shadowRoot)).filter((t=>null!==t)).forEach((t=>{t?.querySelectorAll(".config-chapter-link").forEach((t=>{t.style.display="flex";}));}));},configButton=()=>{const t=Et({class:"icon",style:'background-image: url(\'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>\'); width: 20px; height: 20px; display: block; background-size: contain;'});return bt({onclick:()=>replaceAppState({openReaderConfig:true}),style:"height: 30px; min-width: 30px; display: flex; align-items: center; justify-content: center;"},t)},chapterButton=(t,n)=>bt({disable:!n,onclick:()=>n&&(window.location.href=n),style:"height: 30px; min-width: 30px; display: flex; align-items: center; justify-content: center;"},t),{div:Tt}=p.tags;e("reader-view",(({mount:t})=>{const n=Tt({class:"content-container"}),a=p.state(false);return t((()=>((async()=>{const t=await(async t=>{try{return await db_get(`translated:${t}`)}catch(n){return console.error("Failed to get from history:",n),null}})(window.location.href);if(p.derive((()=>{a.val=Ge.readerView.bionicReading,t&&(n.innerHTML=true===a.val?U(t):t,visbile(),console.log("////"));})),!t){n.innerText="[Xin đợi...]";const t=document.cloneNode(true),o=new ft.Readability(t).parse();await translateFunc(o?.content,(t=>{n.innerHTML=true===a.val?U(t):t;})),visbile();}})(),()=>{p.derive((async()=>{ true===He.isTranslating&&(He.isTranslating=false,window.location.reload());}));}))),[render,n,render]}),false);const{div:At,select:wt,option:St,textarea:Nt,label:Ot,button:xt}=p.tags,It=p.state("");function showSavedFeedback(){It.val="Saved",setTimeout((()=>{It.val="";}),2e3);}function PromptSelector({lbl:t,prompts:n,onSelect:a,onContentChange:o}){const r=n.find((t=>t.selected))||n[0],s=p.state(r?.content||"");return At({class:"pure-g",style:"padding: 0 0.5em; margin-bottom: 0.5em;"},At({class:"pure-u-1"},Ot({class:""},t),At({class:"pure-form pure-form-stacked"},At({class:"pure-g",style:"padding-right: 1em"},At({class:"pure-u-20-24"},wt({class:"pure-input-1",value:r?.name,onchange:t=>{const o=t.target.value;a(o);const r=n.find((t=>t.name===o));s.val=r?.content||"",showSavedFeedback();}},...n.map((t=>St({value:t.name},t.name))))),At({class:"pure-u-4-24"},xt({class:"pure-button",style:"margin-left: 0.5em; width: 40px; height: 30.5px; margin-top: 4px; padding: 0; line-height: 2.3em;"},"+"))))),At({class:"pure-u-1",style:"padding-right: 1em"},Nt({class:"pure-input-1",style:"height: 150px; margin-top: 1em; resize: vertical; display: block; box-sizing: border-box; width: 100%;",value:s,onblur:t=>{const n=t.target.value;s.val=n,r&&o(r.name,n),showSavedFeedback();}})))}const{div:Rt,select:Mt,option:Lt,textarea:Dt,label:kt,style:Ft}=p.tags;function AiProviderTab(){const t=p.state(""),showSavedMessage=()=>{t.val="Saved",setTimeout((()=>t.val=""),2e3);};return Rt(Rt({class:"pure-g",style:"padding: 0 0.5em; "},Rt({class:"pure-u-1"},Rt({class:"pure-form pure-form-stacked"},Rt({class:"pure-control-group"},kt({class:"form-label"},"Provider"),Mt({class:"pure-input-1",onchange:t=>{const n=t.target.value;Ge.providers.forEach((t=>{t.selected=t.name===n;})),showSavedMessage();}},...Ge.providers.map((t=>Lt({selected:t.selected,value:t.name},t.name))))),Rt({class:"pure-control-group"},kt({class:"form-label"},"Model"),Mt({class:"pure-input-1",onchange:t=>{const n=Ge.providers.find((t=>t.selected));if(n){const a=t.target.value;n.models.forEach((t=>{t.selected=t.name===a;})),showSavedMessage();}}},(()=>{const t=Ge.providers.find((t=>t.selected));return t?t.models.map((t=>Lt({selected:t.selected,value:t.name},t.name))):[Lt({disabled:true},"Select a provider first")]})())),Rt({class:"pure-control-group"},kt({class:"form-label"},"API Key"),Dt({rows:4,class:"pure-input-1",placeholder:"Enter your API key",value:()=>Ge.providers?.find((t=>t.selected))?.apiKey||"",onblur:t=>{const n=Ge.providers.find((t=>t.selected));n&&(n.apiKey=t.target.value,showSavedMessage());}})),Rt({class:"pure-control-group"},(()=>{const t=Ge.providers?.find((t=>t.selected))?.note;return t?Rt({innerHTML:t}):null})),kt({class:"saved-message"},(()=>t.val))))),Ft("\n            .ai-provider-container {\n                max-width: 600px;\n                margin: 0 auto;\n            }\n            .form-label {\n                display: block;\n                margin-bottom: 0.5rem;\n                font-weight: 500;\n                color: #333;\n            }\n            .saved-message {\n                color: #00aa00;\n                margin: 0.5rem 0;\n                font-size: 0.9rem;\n                font-weight: bold;\n                text-align: center;\n                display: block;\n            }\n            textarea.pure-input-1 {\n                resize: none;\n                min-height: 100px;\n            }\n            \n            @media screen and (max-width: 48em) {\n\n            \n            }\n        "))}const{div:Ut,label:Gt,button:Ht}=p.tags;function VersionTab(){const t=p.state("");return [Ut({class:"pure-form pure-form-stacked"},[Ut({class:"pure-g",style:"padding: 0px 0.5em;"},[Ut({class:"pure-u-1 pure-u-md-1-2 pure-u-lg-1-3"},[Gt({class:"pure-u-1"},`Current version: ${Ge.version}`),Ut({innerHTML:t,class:"pure-u-1",style:"margin-bottom:20px;border: 1px solid #ccc; min-height: 150px; background: #fff;"}),Ht({onclick:async()=>{t.val=await async function displayVersion(t=false){const n=await getRelease(t);return `Latest version: ${n.version}<br/><b>Link download: </b><a href="${n.fileUrl}" target="blank">dichtruyen.ai.vn.user.js</a><br/>${n.description}`}(true);},class:"pure-button pure-button-primary pure-u-1",style:"margin-bottom: 10px"},"Check Update"),Ht({onclick:async()=>await mergeSystemPrompt(Ge),class:"pure-button button-success pure-u-1",style:"margin-bottom: 10px"},"Update System Prompt"),Ht({onclick:async()=>await mergeProviders(Ge),class:"pure-button button-success pure-u-1",style:"margin-bottom: 10px"},"Update AI Providers")])])])]}const{div:jt,style:qt}=p.tags;e("settings-view",(()=>[qt("\n            .tbbt.active{\n                background-color:rgba(58, 119, 224, 0.88) !important;\n            }\n        "),jt({id:"settings-container"},Tabs({style:"max-width: 500px;",tabButtonBorderStyle:"none",tabButtonClass:"tbbt",tabButtonRowColor:"none",tabButtonRowStyleOverrides:{"padding-left":"12px"}},{Prompt:[At({class:"pure-g"},At({class:"pure-u-1"},PromptSelector({lbl:"System Prompts",prompts:Ge.prompt.systemPrompts.map((t=>({name:t.name,content:t.content||"",selected:t.selected}))),onSelect:t=>{Ge.prompt.systemPrompts.forEach((n=>n.selected=n.name===t));},onContentChange:(t,n)=>{const a=Ge.prompt.systemPrompts.find((n=>n.name===t));a&&(a.content=n);}}),PromptSelector({lbl:"User Prompts",prompts:Ge.prompt.userPrompts.map((t=>({name:t.name,content:t.content||"",selected:t.selected}))),onSelect:t=>{Ge.prompt.userPrompts.forEach((n=>n.selected=n.name===t));},onContentChange:(t,n)=>{const a=Ge.prompt.userPrompts.find((n=>n.name===t));a&&(a.content=n);}}))),Ot({id:"lblRs1",class:"pure-form-message-inline",style:"color: green; text-align: center; display: block; width: 100%"},It)],AI:AiProviderTab,Update:VersionTab()}))]),false);const{div:$t}=p.tags,CurrentView=()=>{const t=$t();return p.derive((()=>{if("empty"!==He.currentView){if(t.id="view",t.childElementCount>0)for(const a of t.childNodes)a.remove();const n=document.createElement(`${He.currentView}-view`);t.appendChild(n);}else if(t.id="",t.childElementCount>0)for(const n of t.childNodes)n.remove();})),t},{style:Wt}=p.tags;await( async function initStore(){const t=await ke.getValue("dichtruyen-ai"),n=await getRelease(true);if(t){let o=JSON.parse(t);const r=0==o.prompt.systemPrompts.length||0===o.providers.length;if(o.version!==n.version||r)try{o.version=n.version,o=await mergeSystemPrompt(o),o=await mergeProviders(o),Ue=o,console.log(Ue);}catch(a){console.error("Failed to fetch remote prompt:",a);}else Ue=o;}else {const t=await getSystemPrompt(),n=Fe;n.prompt.systemPrompts.push({id:"default-0",name:"Default",content:t,selected:true});const a=await getAiProviders();n.providers=a?.providers,Ue=n,console.log(Ue);}replace(Ge,Ue),p.derive((async()=>{console.log("Saved setting",(new Date).toUTCString()),await ke.setValue("dichtruyen-ai",JSON.stringify(compact(Ge)));}));}()),e("dichtruyen-ai",(()=>{const t=p.derive((()=>{const t="black"===Ge.readerView.backgroundColor?"white":"black";return `\n    reader-view {\n      background-color: ${Ge.readerView.backgroundColor} !important;\n    }\n    .content-container {\n      font-family: ${Ge.readerView.fontFamily}, -apple-system, sans-serif;\n      line-height: ${Ge.readerView.lineHeight};\n      font-size: ${Ge.readerView.fontSize}px;\n      color: ${t};\n      margin: 5px auto;\n      padding: 10px;\n      box-sizing: border-box;\n      width: 100%;\n      max-width: 800px;\n      white-space: pre-wrap;\n    }\n    .article-title {\n      font-size: 1.5em;\n      font-weight: bold;\n      margin-bottom: 1em;\n      text-align: center;\n    }\n  `}));return [Wt("\n          :host {\n            display: block;\n            height: 100%;\n            width: 100%;\n            pointer-events: all;\n          }\n        #bottom-bar {\n          position: fixed;\n          bottom: 0;\n          left: 0;\n          right: 0;\n          background-color: white;\n          box-shadow: 0 -2px 5px rgba(0,0,0,0.1);\n          padding: 10px;\n          display: flex;\n          justify-content: center;\n          gap: 20px;\n          width: 100%;\n          height: auto;\n          min-height: 60px;\n          box-sizing: border-box;\n          -webkit-overflow-scrolling: touch;\n          pointer-events: auto;\n          isolation: isolate;\n          z-index: 9999;\n        }\n        .icon-button {\n          background: none;\n          border: none;\n          cursor: pointer;\n          padding: 8px;\n          border-radius: 50%;\n          background-color: white;\n          box-shadow: 0 2px 5px rgba(0,0,0,0.2);\n          touch-action: manipulation;\n          width: 40px;\n          height: 40px;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          position: relative;\n          z-index: 1;\n        }\n        .icon {\n          display: inline-block;\n          width: 24px;\n          height: 24px;\n          background-size: contain;\n          background-repeat: no-repeat;\n          vertical-align: middle;\n        }\n        #mdlReaderContainer p{\n          margin: 5px 0px;\n        }\n      "),Wt("\n      #view {\n          width: 100%;\n          height: 100%;\n          background-color: white;\n        }\n        history-view, settings-view, reader-view {\n          display: block;\n          width: 100%;\n\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n          z-index: 9999;\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 60px;\n          overflow-y: auto;\n          -webkit-overflow-scrolling: touch;\n          background-color: white;\n        }\n      "),Wt(t),Await({value:fetchResource("https://cdn.jsdelivr.net/npm/purecss@3.0.0/build/pure-min.css"),container:Wt,Loading:()=>""},(t=>t)),Wt("\n    .button-success,\n        .button-error,\n        .button-warning,\n        .button-secondary {\n            color: white;\n            border-radius: 4px;\n            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);\n        }\n\n        .button-success {\n            background: rgb(28, 184, 65);\n            /* this is a green */\n        }\n\n        .button-error {\n            background: rgb(202, 60, 60);\n            /* this is a maroon */\n        }\n\n        .button-warning {\n            background: rgb(223, 117, 20);\n            /* this is an orange */\n        }\n\n        .button-secondary {\n            background: rgb(66, 184, 221);\n            /* this is a light blue */\n        }  \n      "),CurrentView(),ModalReaderConfig(),(p.derive((()=>{"reader"===He.currentView&&(true===He.isTranslating?changeIcon(Je):changeIcon(Ke));})),$e({id:"bottom-bar"},createIconButton(We,(()=>changeView("history"))),createIconButton(Ke,(()=>changeView("reader")),"transButton"),createIconButton(Ye,(()=>changeView("settings")))))]}));const Kt=document.createElement("dichtruyen-ai");window.parent.document.body.appendChild(Kt);

})();